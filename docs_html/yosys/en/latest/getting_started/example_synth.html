<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Scripting in Yosys" href="scripting_intro.html" /><link rel="prev" title="Installation" href="installation.html" />

    <link rel="shortcut icon" href="../_static/yshq_favicon.png"/><!-- Generated with Sphinx 8.2.3 and Furo 2025.04.22.dev1 -->
        <title>Synthesis starter - YosysHQ Yosys 0.55-dev documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-ys.css?v=5cc2bdad" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=8dab3a3b" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=63c85a92" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style><script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="yosys" /><meta name="readthedocs-version-slug" content="latest" /><meta name="readthedocs-resolver-filename" content="/getting_started/example_synth.html" /><meta name="readthedocs-http-status" content="200" /></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">YosysHQ Yosys 0.55-dev documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand"
   title="External link to https://yosyshq.readthedocs.io"
   href="https://yosyshq.readthedocs.io"><div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/yshq_logo.png" alt="Main Brand Logo"/>
  </div>
  
  
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Yosys (index)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">What is Yosys</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Getting started with Yosys</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Getting started with Yosys</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Synthesis starter</a></li>
<li class="toctree-l2"><a class="reference internal" href="scripting_intro.html">Scripting in Yosys</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../using_yosys/index.html">Using Yosys (advanced)</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Using Yosys (advanced)</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../using_yosys/synthesis/index.html">Synthesis in detail</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Synthesis in detail</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/synth.html">Synth commands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/proc.html">Converting process blocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/fsm.html">FSM handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/memory.html">Memory handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/opt.html">Optimization passes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/techmap_synth.html">Technology mapping</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/extract.html">The extract pass</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/abc.html">The ABC toolbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/synthesis/cell_libs.html">Mapping to cell libraries</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../using_yosys/more_scripting/index.html">More scripting</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of More scripting</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/more_scripting/load_design.html">Loading a design</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/more_scripting/selections.html">Selections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/more_scripting/interactive_investigation.html">Interactive design investigation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/more_scripting/model_checking.html">Symbolic model checking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../using_yosys/more_scripting/data_flow_tracking.html">Dataflow tracking</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../yosys_internals/index.html">Yosys internals</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Yosys internals</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../yosys_internals/flow/index.html">Internal flow</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Internal flow</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/flow/overview.html">Flow overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/flow/control_and_data.html">Control and data flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/flow/verilog_frontend.html">The Verilog and AST frontends</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../yosys_internals/formats/index.html">Internal formats</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Internal formats</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/formats/rtlil_rep.html">The RTL Intermediate Language (RTLIL)</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../yosys_internals/extending_yosys/index.html">Working with the Yosys codebase</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Working with the Yosys codebase</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/extending_yosys/extensions.html">Writing extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/extending_yosys/build_verific.html">Compiling with Verific library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/extending_yosys/functional_ir.html">Writing a new backend using FunctionalIR</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/extending_yosys/contributing.html">Contributing to Yosys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../yosys_internals/extending_yosys/test_suites.html">Testing Yosys</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../yosys_internals/techmap.html">Techmap by example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yosys_internals/verilog.html">Notes on Verilog support in Yosys</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yosys_internals/hashing.html">Hashing and associative data structures in Yosys</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../appendix/primer.html">A primer on digital circuit synthesis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/rtlil_text.html">RTLIL text representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/auxlibs.html">Auxiliary libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix/auxprogs.html">Auxiliary programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bib.html">Literature references</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cell_index.html">Internal cell library</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Internal cell library</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cell/index_word.html">Word-level cells</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Word-level cells</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_unary.html">Unary operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_binary.html">Binary operators</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_mux.html">Multiplexers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_reg.html">Registers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_mem.html">Memories</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_fsm.html">Finite state machines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_arith.html">Coarse arithmetics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_logic.html">Arbitrary logic functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_spec.html">Specify rules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_formal.html">Formal verification cells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_debug.html">Debugging cells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/word_wire.html">Wire cells</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../cell/index_gate.html">Gate-level cells</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Gate-level cells</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../cell/gate_comb_simple.html">Combinatorial cells (simple)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/gate_comb_combined.html">Combinatorial cells (combined)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/gate_reg_ff.html">Flip-flop cells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/gate_reg_latch.html">Latch cells</a></li>
<li class="toctree-l3"><a class="reference internal" href="../cell/gate_other.html">Other gate-level cells</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cell/properties.html">Cell properties</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../cmd_ref.html">Command line reference</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of Command line reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../appendix/env_vars.html">Yosys environment variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/abc.html">abc - use ABC for technology mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/abc9.html">abc9 - use ABC9 for technology mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/abc9_exe.html">abc9_exe - use ABC9 for technology mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/abc9_ops.html">abc9_ops - helper functions for ABC9</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/abc_new.html">abc_new - (experimental) use ABC for SC technology mapping (new)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/abstract.html">abstract - replace signals with abstract values during formal verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/add.html">add - add objects to the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/aigmap.html">aigmap - map logic to and-inverter-graph circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/alumacc.html">alumacc - extract ALU and MACC cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/anlogic_eqn.html">anlogic_eqn - Anlogic: Calculate equations for luts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/anlogic_fixcarry.html">anlogic_fixcarry - Anlogic: fix carry chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/assertpmux.html">assertpmux - adds asserts for parallel muxes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/async2sync.html">async2sync - convert async FF inputs to sync circuits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/attrmap.html">attrmap - renaming attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/attrmvcp.html">attrmvcp - move or copy attributes from wires to driving cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/autoname.html">autoname - automatically assign names to objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/blackbox.html">blackbox - convert modules into blackbox modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/bmuxmap.html">bmuxmap - transform $bmux cells to trees of $mux cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/booth.html">booth - map $mul cells to Booth multipliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/box_derive.html">box_derive - derive box modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/bufnorm.html">bufnorm - (experimental) convert design into buffered-normalized form</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/bugpoint.html">bugpoint - minimize testcases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/bwmuxmap.html">bwmuxmap - replace $bwmux cells with equivalent logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/cd.html">cd - a shortcut for ‘select -module &lt;name&gt;’</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/cellmatch.html">cellmatch - match cells to their targets in cell library</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/check.html">check - check for obvious problems in the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/chformal.html">chformal - change formal constraints of the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/chparam.html">chparam - re-evaluate modules with new parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/chtype.html">chtype - change type of cells in the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/clean.html">clean - remove unused cells and wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/clean_zerowidth.html">clean_zerowidth - clean zero-width connections from the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/clk2fflogic.html">clk2fflogic - convert clocked FFs to generic $ff cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/clkbufmap.html">clkbufmap - insert clock buffers on clock networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/clockgate.html">clockgate - extract clock gating out of flip flops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/connect.html">connect - create or remove connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/connect_rpc.html">connect_rpc - connect to RPC frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/connwrappers.html">connwrappers - match width of input-output port pairs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/constmap.html">constmap - technology mapping of coarse constant value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/coolrunner2_fixup.html">coolrunner2_fixup - insert necessary buffer cells for CoolRunner-II architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/coolrunner2_sop.html">coolrunner2_sop - break $sop cells into ANDTERM/ORTERM cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/copy.html">copy - copy modules in the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/cover.html">cover - print code coverage counters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/cutpoint.html">cutpoint - adds formal cut points to the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/debug.html">debug - run command with debug log messages enabled</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/delete.html">delete - delete objects in the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/deminout.html">deminout - demote inout ports to input or output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/demuxmap.html">demuxmap - transform $demux cells to $eq + $mux cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/design.html">design - save, restore and reset current design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/dffinit.html">dffinit - set INIT param on FF cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/dfflegalize.html">dfflegalize - convert FFs to types supported by the target</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/dfflibmap.html">dfflibmap - technology mapping of flip-flops</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/dffunmap.html">dffunmap - unmap clock enable and synchronous reset from FFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/dft_tag.html">dft_tag - create tagging logic for data flow tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/dump.html">dump - print parts of the design in RTLIL format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/echo.html">echo - turning echoing back of commands on and off</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/edgetypes.html">edgetypes - list all types of edges in selection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/efinix_fixcarry.html">efinix_fixcarry - Efinix: fix carry chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_add.html">equiv_add - add a $equiv cell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_induct.html">equiv_induct - proving $equiv cells using temporal induction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_make.html">equiv_make - prepare a circuit for equivalence checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_mark.html">equiv_mark - mark equivalence checking regions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_miter.html">equiv_miter - extract miter from equiv circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_opt.html">equiv_opt - prove equivalence for optimized circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_purge.html">equiv_purge - purge equivalence checking module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_remove.html">equiv_remove - remove $equiv cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_simple.html">equiv_simple - try proving simple $equiv instances</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_status.html">equiv_status - print status of equivalent checking module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/equiv_struct.html">equiv_struct - structural equivalence checking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/eval.html">eval - evaluate the circuit given an input</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/example_dt.html">example_dt - drivertools example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/exec.html">exec - execute commands in the operating system shell</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/expose.html">expose - convert internal signals to module ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/extract.html">extract - find subcircuits and replace them with cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/extract_counter.html">extract_counter - Extract GreenPak4 counter cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/extract_fa.html">extract_fa - find and extract full/half adders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/extract_reduce.html">extract_reduce - converts gate chains into $reduce_* cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/extractinv.html">extractinv - extract explicit inverter cells for invertible cell pins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/flatten.html">flatten - flatten design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/flowmap.html">flowmap - pack LUTs with FlowMap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fmcombine.html">fmcombine - combine two instances of a cell into one</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fminit.html">fminit - set init values/sequences for formal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/formalff.html">formalff - prepare FFs for formal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/freduce.html">freduce - perform functional reduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm.html">fsm - extract and optimize finite state machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm_detect.html">fsm_detect - finding FSMs in design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm_expand.html">fsm_expand - expand FSM cells by merging logic into it</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm_export.html">fsm_export - exporting FSMs to KISS2 files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm_extract.html">fsm_extract - extracting FSMs in design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm_info.html">fsm_info - print information on finite state machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm_map.html">fsm_map - mapping FSMs to basic logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm_opt.html">fsm_opt - optimize finite state machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fsm_recode.html">fsm_recode - recoding finite state machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/fst2tb.html">fst2tb - generate testbench out of fst file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/future.html">future - resolve future sampled value functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/gatemate_foldinv.html">gatemate_foldinv - fold inverters into Gatemate LUT trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/glift.html">glift - create GLIFT models and optimization problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/greenpak4_dffinv.html">greenpak4_dffinv - merge greenpak4 inverters and DFF/latches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/help.html">help - display help messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/hierarchy.html">hierarchy - check, expand and clean up design hierarchy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/hilomap.html">hilomap - technology mapping of constant hi- and/or lo-drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/history.html">history - show last interactive commands</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ice40_braminit.html">ice40_braminit - iCE40: perform SB_RAM40_4K initialization from file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ice40_dsp.html">ice40_dsp - iCE40: map multipliers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ice40_opt.html">ice40_opt - iCE40: perform simple optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ice40_wrapcarry.html">ice40_wrapcarry - iCE40: wrap carries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/insbuf.html">insbuf - insert buffer cells for connected wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/internal_stats.html">internal_stats - print internal statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/iopadmap.html">iopadmap - technology mapping of i/o pads (or buffers)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/jny.html">jny - write design and metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/json.html">json - write design in JSON format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/keep_hierarchy.html">keep_hierarchy - selectively add the keep_hierarchy attribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/lattice_gsr.html">lattice_gsr - Lattice: handle GSR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/libcache.html">libcache - control caching of technology library data parsed from liberty files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/license.html">license - print license terms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/log.html">log - print text and log files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/logger.html">logger - set logger properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ls.html">ls - list modules or objects in modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ltp.html">ltp - print longest topological path</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/lut2mux.html">lut2mux - convert $lut to $_MUX_</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/maccmap.html">maccmap - mapping macc cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory.html">memory - translate memories to basic cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_bmux2rom.html">memory_bmux2rom - convert muxes to ROMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_bram.html">memory_bram - map memories to block rams</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_collect.html">memory_collect - creating multi-port memory cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_dff.html">memory_dff - merge input/output DFFs into memory read ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_libmap.html">memory_libmap - map memories to cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_map.html">memory_map - translate multiport memories to basic cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_memx.html">memory_memx - emulate vlog sim behavior for mem ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_narrow.html">memory_narrow - split up wide memory ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_nordff.html">memory_nordff - extract read port FFs from memories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_share.html">memory_share - consolidate memory ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/memory_unpack.html">memory_unpack - unpack multi-port memory cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/microchip_dffopt.html">microchip_dffopt - MICROCHIP: optimize FF control signal usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/microchip_dsp.html">microchip_dsp - MICROCHIP: pack resources into DSPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/miter.html">miter - automatically create a miter circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/mutate.html">mutate - generate or apply design mutations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/muxcover.html">muxcover - cover trees of MUX cells with wider MUXes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/muxpack.html">muxpack - $mux/$pmux cascades to $pmux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/nlutmap.html">nlutmap - map to LUTs of different sizes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/nx_carry.html">nx_carry - NanoXplore: create carry cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/onehot.html">onehot - optimize $eq cells for onehot signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt.html">opt - perform simple optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_clean.html">opt_clean - remove unused cells and wires</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_demorgan.html">opt_demorgan - Optimize reductions with DeMorgan equivalents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_dff.html">opt_dff - perform DFF optimizations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_expr.html">opt_expr - perform const folding and simple expression rewriting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_ffinv.html">opt_ffinv - push inverters through FFs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_lut.html">opt_lut - optimize LUT cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_lut_ins.html">opt_lut_ins - discard unused LUT inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_mem.html">opt_mem - optimize memories</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_mem_feedback.html">opt_mem_feedback - convert memory read-to-write port feedback paths to write enables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_mem_priority.html">opt_mem_priority - remove priority relations between write ports that can never collide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_mem_widen.html">opt_mem_widen - optimize memories where all ports are wide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_merge.html">opt_merge - consolidate identical cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_muxtree.html">opt_muxtree - eliminate dead trees in multiplexer trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_reduce.html">opt_reduce - simplify large MUXes and AND/OR gates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/opt_share.html">opt_share - merge mutually exclusive cells of the same type that share an input signal</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/paramap.html">paramap - renaming cell parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/peepopt.html">peepopt - collection of peephole optimizers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/plugin.html">plugin - load and list loaded plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/pmux2shiftx.html">pmux2shiftx - transform $pmux cells to $shiftx cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/pmuxtree.html">pmuxtree - transform $pmux cells to trees of $mux cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/portarcs.html">portarcs - derive port arcs for propagation delay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/portlist.html">portlist - list (top-level) ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/prep.html">prep - generic synthesis script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/printattrs.html">printattrs - print attributes of selected objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc.html">proc - translate processes to netlists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_arst.html">proc_arst - detect asynchronous resets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_clean.html">proc_clean - remove empty parts of processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_dff.html">proc_dff - extract flip-flops from processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_dlatch.html">proc_dlatch - extract latches from processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_init.html">proc_init - convert initial block to init attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_memwr.html">proc_memwr - extract memory writes from processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_mux.html">proc_mux - convert decision trees to multiplexers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_prune.html">proc_prune - remove redundant assignments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_rmdead.html">proc_rmdead - eliminate dead trees in decision trees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/proc_rom.html">proc_rom - convert switches to ROMs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/qbfsat.html">qbfsat - solve a 2QBF-SAT problem in the circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ql_bram_merge.html">ql_bram_merge - Infers QuickLogic k6n10f BRAM pairs that can operate independently</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ql_bram_types.html">ql_bram_types - Change TDP36K type to subtypes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ql_dsp_io_regs.html">ql_dsp_io_regs - change types of QL_DSP2 depending on configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ql_dsp_macc.html">ql_dsp_macc - infer QuickLogic multiplier-accumulator DSP cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ql_dsp_simd.html">ql_dsp_simd - merge QuickLogic K6N10f DSP pairs to operate in SIMD mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/ql_ioff.html">ql_ioff - Infer I/O FFs for qlf_k6n10f architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read.html">read - load HDL designs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read_aiger.html">read_aiger - read AIGER file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read_blif.html">read_blif - read BLIF file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read_json.html">read_json - read JSON file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read_liberty.html">read_liberty - read cells from liberty file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read_rtlil.html">read_rtlil - read modules from RTLIL file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read_verilog.html">read_verilog - read modules from Verilog file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read_verilog_file_list.html">read_verilog_file_list - parse a Verilog file list</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/read_xaiger2.html">read_xaiger2 - (experimental) read XAIGER file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/recover_names.html">recover_names - Execute a lossy mapping command and recover original netnames</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/rename.html">rename - rename object in the design</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/rmports.html">rmports - remove module ports with no connections</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/sat.html">sat - solve a SAT problem in the circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/scatter.html">scatter - add additional intermediate nets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/scc.html">scc - detect strongly connected components (logic loops)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/scratchpad.html">scratchpad - get/set values in the scratchpad</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/script.html">script - execute commands from file or wire</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/select.html">select - modify and view the list of selected objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/setattr.html">setattr - set/unset attributes on objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/setenv.html">setenv - set an environment variable</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/setparam.html">setparam - set/unset parameters on objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/setundef.html">setundef - replace undef values with defined constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/share.html">share - perform sat-based resource sharing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/shell.html">shell - enter interactive command mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/show.html">show - generate schematics using graphviz</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/shregmap.html">shregmap - map shift registers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/sim.html">sim - simulate the circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/simplemap.html">simplemap - mapping simple coarse-grain cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/splice.html">splice - create explicit splicing cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/splitcells.html">splitcells - split up multi-bit cells</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/splitnets.html">splitnets - split up multi-bit nets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/sta.html">sta - perform static timing analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/stat.html">stat - print some statistics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/submod.html">submod - moving part of a module to a new submodule</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/supercover.html">supercover - add hi/lo cover cells for each wire bit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth.html">synth - generic synthesis script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_achronix.html">synth_achronix - synthesis for Achronix Speedster22i FPGAs.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_anlogic.html">synth_anlogic - synthesis for Anlogic FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_coolrunner2.html">synth_coolrunner2 - synthesis for Xilinx Coolrunner-II CPLDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_easic.html">synth_easic - synthesis for eASIC platform</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_ecp5.html">synth_ecp5 - synthesis for ECP5 FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_efinix.html">synth_efinix - synthesis for Efinix FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_fabulous.html">synth_fabulous - FABulous synthesis script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_gatemate.html">synth_gatemate - synthesis for Cologne Chip GateMate FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_gowin.html">synth_gowin - synthesis for Gowin FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_greenpak4.html">synth_greenpak4 - synthesis for GreenPAK4 FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_ice40.html">synth_ice40 - synthesis for iCE40 FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_intel.html">synth_intel - synthesis for Intel (Altera) FPGAs.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_intel_alm.html">synth_intel_alm - synthesis for ALM-based Intel (Altera) FPGAs.</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_lattice.html">synth_lattice - synthesis for Lattice FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_microchip.html">synth_microchip - synthesis for Microchip FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_nanoxplore.html">synth_nanoxplore - synthesis for NanoXplore FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_nexus.html">synth_nexus - synthesis for Lattice Nexus FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_quicklogic.html">synth_quicklogic - Synthesis for QuickLogic FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_sf2.html">synth_sf2 - synthesis for SmartFusion2 and IGLOO2 FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synth_xilinx.html">synth_xilinx - synthesis for Xilinx FPGAs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/synthprop.html">synthprop - synthesize SVA properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/tcl.html">tcl - execute a TCL script file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/techmap.html">techmap - generic technology mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/tee.html">tee - redirect command output to file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/test_abcloop.html">test_abcloop - automatically test handling of loops in abc command</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/test_autotb.html">test_autotb - generate simple test benches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/test_cell.html">test_cell - automatically test the implementation of a cell type</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/test_generic.html">test_generic - test the generic compute graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/test_pmgen.html">test_pmgen - test pass for pmgen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/test_select.html">test_select - call internal selection methods on design for testing purposes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/timeest.html">timeest - estimate timing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/torder.html">torder - print cells in topological order</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/trace.html">trace - redirect command output to file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/tribuf.html">tribuf - infer tri-state buffers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/uniquify.html">uniquify - create unique copies of modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/verific.html">verific - load Verilog and VHDL designs using Verific</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/verilog_defaults.html">verilog_defaults - set default options for read_verilog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/verilog_defines.html">verilog_defines - define and undefine verilog defines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/viz.html">viz - visualize data flow graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/wbflip.html">wbflip - flip the whitebox attribute</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/wrapcell.html">wrapcell - wrap individual cells into new modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/wreduce.html">wreduce - reduce the word size of operations if possible</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_aiger.html">write_aiger - write design to AIGER file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_aiger2.html">write_aiger2 - (experimental) write design to AIGER file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_blif.html">write_blif - write design to BLIF file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_btor.html">write_btor - write design to BTOR file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_cxxrtl.html">write_cxxrtl - convert design to C++ RTL simulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_edif.html">write_edif - write design to EDIF netlist file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_file.html">write_file - write a text to a file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_firrtl.html">write_firrtl - write design to a FIRRTL file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_functional_cxx.html">write_functional_cxx - convert design to C++ using the functional backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_functional_rosette.html">write_functional_rosette - Generate Rosette compatible Racket from Functional IR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_functional_smt2.html">write_functional_smt2 - Generate SMT-LIB from Functional IR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_intersynth.html">write_intersynth - write design to InterSynth netlist file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_jny.html">write_jny - generate design metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_json.html">write_json - write design to a JSON file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_rtlil.html">write_rtlil - write design to RTLIL file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_simplec.html">write_simplec - convert design to simple C code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_smt2.html">write_smt2 - write design to SMT-LIBv2 file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_smv.html">write_smv - write design to SMV file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_spice.html">write_spice - write design to SPICE netlist file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_table.html">write_table - write design as connectivity table</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_verilog.html">write_verilog - write design to Verilog file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_xaiger.html">write_xaiger - write design to XAIGER file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/write_xaiger2.html">write_xaiger2 - (experimental) write module to XAIGER file</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/xilinx_dffopt.html">xilinx_dffopt - Xilinx: optimize FF control signal usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/xilinx_dsp.html">xilinx_dsp - Xilinx: pack resources into DSPs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/xilinx_srl.html">xilinx_srl - Xilinx shift register extraction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/xprop.html">xprop - formal x propagation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cmd/zinit.html">zinit - add inverters so all FF are zero-initialized</a></li>
</ul>
</li>
</ul>

</div>

<div
  id="furo-sidebar-ad-placement"
  class="flat"
  data-ea-publisher="readthedocs"
  data-ea-type="readthedocs-sidebar"
  data-ea-manual="true"
></div>
</div>



      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/YosysHQ/yosys/blob/main/docs/source/getting_started/example_synth.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/YosysHQ/yosys/edit/main/docs/source/getting_started/example_synth.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="synthesis-starter">
<h1>Synthesis starter<a class="headerlink" href="#synthesis-starter" title="Link to this heading">¶</a></h1>
<p>This page will be a guided walkthrough of the prepackaged iCE40 FPGA synthesis
script - <a class="reference internal" href="../cmd/synth_ice40.html#cmd-synth_ice40" title="synthesis for iCE40 FPGAs"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">synth_ice40</span></code></a>.  We will take a simple design through each step, looking
at the commands being called and what they do to the design. While <a class="reference internal" href="../cmd/synth_ice40.html#cmd-synth_ice40" title="synthesis for iCE40 FPGAs"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">synth_ice40</span></code></a>
is specific to the iCE40 platform, most of the operations we will be discussing
are common across the majority of FPGA synthesis scripts. Thus, this document
will provide a good foundational understanding of how synthesis in Yosys is
performed, regardless of the actual architecture being used.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for
<a class="reference internal" href="../using_yosys/synthesis/synth.html"><span class="doc">Synth commands</span></a></p>
</div>
<section id="demo-design">
<h2>Demo design<a class="headerlink" href="#demo-design" title="Link to this heading">¶</a></h2>
<p>First, let’s quickly look at the design we’ll be synthesizing:</p>
<div class="literal-block-wrapper docutils container" id="fifo-v">
<div class="code-block-caption"><span class="caption-number">Listing 1 </span><span class="caption-text"><code class="file docutils literal notranslate"><span class="pre">fifo.v</span></code></span><a class="headerlink" href="#fifo-v" title="Link to this code">¶</a></div>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">// address generator/counter</span>
<span class="linenos"> 2</span><span class="k">module</span><span class="w"> </span><span class="n">addr_gen</span><span class="w"> </span>
<span class="linenos"> 3</span><span class="p">#(</span><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="n">MAX_DATA</span><span class="o">=</span><span class="mh">256</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="w">	</span><span class="k">localparam</span><span class="w"> </span><span class="n">AWIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">$clog2</span><span class="p">(</span><span class="n">MAX_DATA</span><span class="p">)</span>
<span class="linenos"> 5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">en</span><span class="p">,</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span><span class="w"> </span><span class="n">rst</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">	</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="n">AWIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span>
<span class="linenos"> 7</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="w">	</span><span class="k">initial</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">	</span><span class="c1">// async reset</span>
<span class="linenos">11</span><span class="w">	</span><span class="c1">// increment address when enabled</span>
<span class="linenos">12</span><span class="w">	</span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">rst</span><span class="p">)</span>
<span class="linenos">13</span><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
<span class="linenos">14</span><span class="w">			</span><span class="n">addr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<span class="linenos">15</span><span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">en</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="linenos">16</span><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">({</span><span class="m">&#39;0</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MAX_DATA</span><span class="o">-</span><span class="mh">1</span><span class="p">)</span>
<span class="linenos">17</span><span class="w">				</span><span class="n">addr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<span class="linenos">18</span><span class="w">			</span><span class="k">else</span>
<span class="linenos">19</span><span class="w">				</span><span class="n">addr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span>
<span class="linenos">20</span><span class="w">		</span><span class="k">end</span>
<span class="linenos">21</span><span class="k">endmodule</span><span class="w"> </span><span class="c1">//addr_gen</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="c1">// Define our top level fifo entity</span>
<span class="linenos">24</span><span class="k">module</span><span class="w"> </span><span class="n">fifo</span><span class="w"> </span>
<span class="linenos">25</span><span class="p">#(</span><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="n">MAX_DATA</span><span class="o">=</span><span class="mh">256</span><span class="p">,</span>
<span class="linenos">26</span><span class="w">	</span><span class="k">localparam</span><span class="w"> </span><span class="n">AWIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">$clog2</span><span class="p">(</span><span class="n">MAX_DATA</span><span class="p">)</span>
<span class="linenos">27</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">wen</span><span class="p">,</span><span class="w"> </span><span class="n">ren</span><span class="p">,</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span><span class="w"> </span><span class="n">rst</span><span class="p">,</span>
<span class="linenos">28</span><span class="w">	</span><span class="k">input</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">wdata</span><span class="p">,</span>
<span class="linenos">29</span><span class="w">	</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">rdata</span><span class="p">,</span>
<span class="linenos">30</span><span class="w">	</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="nl">AWIDTH:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">count</span>
<span class="linenos">31</span><span class="p">);</span>
<span class="linenos">32</span><span class="w">	</span><span class="c1">// fifo storage</span>
<span class="linenos">33</span><span class="w">	</span><span class="c1">// sync read before write</span>
<span class="linenos">34</span><span class="w">	</span><span class="kt">wire</span><span class="w"> </span><span class="p">[</span><span class="n">AWIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">waddr</span><span class="p">,</span><span class="w"> </span><span class="n">raddr</span><span class="p">;</span>
<span class="linenos">35</span><span class="w">	</span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="p">[</span><span class="n">MAX_DATA</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
<span class="linenos">36</span><span class="w">	</span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="linenos">37</span><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wen</span><span class="p">)</span>
<span class="linenos">38</span><span class="w">			</span><span class="n">data</span><span class="p">[</span><span class="n">waddr</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">wdata</span><span class="p">;</span>
<span class="linenos">39</span><span class="w">		</span><span class="n">rdata</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">raddr</span><span class="p">];</span>
<span class="linenos">40</span><span class="w">	</span><span class="k">end</span><span class="w"> </span><span class="c1">// storage</span>
<span class="linenos">41</span>
<span class="linenos">42</span><span class="w">	</span><span class="c1">// addr_gen for both write and read addresses</span>
<span class="linenos">43</span><span class="w">	</span><span class="n">addr_gen</span><span class="w"> </span><span class="p">#(.</span><span class="n">MAX_DATA</span><span class="p">(</span><span class="n">MAX_DATA</span><span class="p">))</span>
<span class="linenos">44</span><span class="w">	</span><span class="n">fifo_writer</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">45</span><span class="w">		</span><span class="p">.</span><span class="n">en</span><span class="w">     </span><span class="p">(</span><span class="n">wen</span><span class="p">),</span>
<span class="linenos">46</span><span class="w">		</span><span class="p">.</span><span class="n">clk</span><span class="w">    </span><span class="p">(</span><span class="n">clk</span><span class="p">),</span>
<span class="linenos">47</span><span class="w">		</span><span class="p">.</span><span class="n">rst</span><span class="w">    </span><span class="p">(</span><span class="n">rst</span><span class="p">),</span>
<span class="linenos">48</span><span class="w">		</span><span class="p">.</span><span class="n">addr</span><span class="w">   </span><span class="p">(</span><span class="n">waddr</span><span class="p">)</span>
<span class="linenos">49</span><span class="w">	</span><span class="p">);</span>
<span class="linenos">50</span>
<span class="linenos">51</span><span class="w">	</span><span class="n">addr_gen</span><span class="w"> </span><span class="p">#(.</span><span class="n">MAX_DATA</span><span class="p">(</span><span class="n">MAX_DATA</span><span class="p">))</span>
<span class="linenos">52</span><span class="w">	</span><span class="n">fifo_reader</span><span class="w"> </span><span class="p">(</span>
<span class="linenos">53</span><span class="w">		</span><span class="p">.</span><span class="n">en</span><span class="w">     </span><span class="p">(</span><span class="n">ren</span><span class="p">),</span>
<span class="linenos">54</span><span class="w">		</span><span class="p">.</span><span class="n">clk</span><span class="w">    </span><span class="p">(</span><span class="n">clk</span><span class="p">),</span>
<span class="linenos">55</span><span class="w">		</span><span class="p">.</span><span class="n">rst</span><span class="w">    </span><span class="p">(</span><span class="n">rst</span><span class="p">),</span>
<span class="linenos">56</span><span class="w">		</span><span class="p">.</span><span class="n">addr</span><span class="w">   </span><span class="p">(</span><span class="n">raddr</span><span class="p">)</span>
<span class="linenos">57</span><span class="w">	</span><span class="p">);</span>
<span class="linenos">58</span>
<span class="linenos">59</span><span class="w">	</span><span class="c1">// status signals</span>
<span class="linenos">60</span><span class="w">	</span><span class="k">initial</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<span class="linenos">61</span>
<span class="linenos">62</span><span class="w">	</span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">rst</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="linenos">63</span><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
<span class="linenos">64</span><span class="w">			</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<span class="linenos">65</span><span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">wen</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">ren</span><span class="p">)</span>
<span class="linenos">66</span><span class="w">			</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span>
<span class="linenos">67</span><span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ren</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">wen</span><span class="p">)</span>
<span class="linenos">68</span><span class="w">			</span><span class="n">count</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span>
<span class="linenos">69</span><span class="w">	</span><span class="k">end</span>
<span class="linenos">70</span>
<span class="linenos">71</span><span class="k">endmodule</span>
</pre></div>
</div>
</div>
<p>While the open source <a class="reference internal" href="../cmd/read_verilog.html#cmd-read_verilog" title="read modules from Verilog file"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">read_verilog</span></code></a> frontend generally does a pretty good job
at processing valid Verilog input, it does not provide very good error handling
or reporting.  Using an external tool such as <a class="reference external" href="https://www.veripool.org/verilator/">verilator</a> before running Yosys
is highly recommended. We can quickly check the Verilog syntax of our design by
calling <code class="docutils literal notranslate"><span class="pre">verilator</span> <span class="pre">--lint-only</span> <span class="pre">fifo.v</span></code>.</p>
</section>
<section id="loading-the-design">
<h2>Loading the design<a class="headerlink" href="#loading-the-design" title="Link to this heading">¶</a></h2>
<p>Let’s load the design into Yosys.  From the command line, we can call <code class="docutils literal notranslate"><span class="pre">yosys</span>
<span class="pre">fifo.v</span></code>.  This will open an interactive Yosys shell session and immediately
parse the code from <a class="reference internal" href="#fifo-v"><span class="std std-ref">fifo.v</span></a> and convert it into an Abstract Syntax Tree
(AST).  If you are interested in how this happens, there is more information in
the document, <a class="reference internal" href="../yosys_internals/flow/verilog_frontend.html"><span class="doc">The Verilog and AST frontends</span></a>.  For now, suffice
it to say that we do this to simplify further processing of the design.  You
should see something like the following:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>yosys<span class="w"> </span>fifo.v

<span class="go">-- Parsing `fifo.v&#39; using frontend ` -vlog2k&#39; --</span>

<span class="go">1. Executing Verilog-2005 frontend: fifo.v</span>
<span class="go">Parsing Verilog input from `fifo.v&#39; to AST representation.</span>
<span class="go">Storing AST representation for module `$abstract\addr_gen&#39;.</span>
<span class="go">Storing AST representation for module `$abstract\fifo&#39;.</span>
<span class="go">Successfully finished Verilog frontend.</span>
</pre></div>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for
<a class="reference internal" href="../using_yosys/more_scripting/load_design.html"><span class="doc">Loading a design</span></a></p>
</div>
</section>
<section id="elaboration">
<h2>Elaboration<a class="headerlink" href="#elaboration" title="Link to this heading">¶</a></h2>
<p>Now that we are in the interactive shell, we can call Yosys commands directly.
Our overall goal is to call <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">synth_ice40</span><span class="w"> </span><span class="na">-top</span><span class="w"> </span><span class="n">fifo</span></code>, but for now we
can run each of the commands individually for a better sense of how each part
contributes to the flow.  We will also start with just a single module;
<code class="docutils literal notranslate"><span class="pre">addr_gen</span></code>.</p>
<p>At the bottom of the <a class="reference internal" href="../cmd/help.html#cmd-help" title="display help messages"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">help</span></code></a> output for
<a class="reference internal" href="../cmd/synth_ice40.html#cmd-synth_ice40" title="synthesis for iCE40 FPGAs"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">synth_ice40</span></code></a> is the complete list of commands called by this script.
Let’s start with the section labeled <code class="docutils literal notranslate"><span class="pre">begin</span></code>:</p>
<div class="literal-block-wrapper docutils container" id="synth-begin">
<div class="code-block-caption"><span class="caption-number">Listing 2 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">begin</span></code> section</span><a class="headerlink" href="#synth-begin" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">read_verilog</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">ICE40_HX</span><span class="w"> </span><span class="na">-lib</span><span class="w"> </span><span class="na">-specify</span><span class="w"> </span><span class="nc">+/ice40/cells_sim.v</span>
<span class="k">hierarchy</span><span class="w"> </span><span class="na">-check</span><span class="w"> </span><span class="na">-top</span><span class="w"> </span><span class="n">&lt;top&gt;</span>
<span class="k">proc</span>
</pre></div>
</div>
</div>
<p><code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">read_verilog</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">ICE40_HX</span><span class="w"> </span><span class="na">-lib</span><span class="w"> </span><span class="na">-specify</span><span class="w"> </span><span class="nc">+/ice40/cells_sim.v</span></code> loads the
iCE40 cell models which allows us to include platform specific IP blocks in our
design.  PLLs are a common example of this, where we might need to reference
<code class="docutils literal notranslate"><span class="pre">SB_PLL40_CORE</span></code> directly rather than being able to rely on mapping passes
later.  Since our simple design doesn’t use any of these IP blocks, we can skip
this command for now.  Because these cell models will also be needed once we
start mapping to hardware we will still need to load them later.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">+/</span></code> is a dynamic reference to the Yosys <code class="docutils literal notranslate"><span class="pre">share</span></code> directory.  By default,
this is <code class="docutils literal notranslate"><span class="pre">/usr/local/share/yosys</span></code>.  If using a locally built version of
Yosys from the source directory, this will be the <code class="docutils literal notranslate"><span class="pre">share</span></code> folder in the
same directory.</p>
</div>
<section id="the-addr-gen-module">
<span id="addr-gen-example"></span><h3>The addr_gen module<a class="headerlink" href="#the-addr-gen-module" title="Link to this heading">¶</a></h3>
<p>Since we’re just getting started, let’s instead begin with <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">hierarchy</span>
<span class="na">-top</span><span class="w"> </span><span class="n">addr_gen</span></code>.  This command declares that the top level module is
<code class="docutils literal notranslate"><span class="pre">addr_gen</span></code>, and everything else can be discarded.</p>
<div class="literal-block-wrapper docutils container" id="addr-gen-v">
<div class="code-block-caption"><span class="caption-number">Listing 3 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">addr_gen</span></code> module source</span><a class="headerlink" href="#addr-gen-v" title="Link to this code">¶</a></div>
<div class="highlight-Verilog notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 2</span><span class="k">module</span><span class="w"> </span><span class="n">addr_gen</span><span class="w"> </span>
<span class="linenos"> 3</span><span class="p">#(</span><span class="w">  </span><span class="k">parameter</span><span class="w"> </span><span class="n">MAX_DATA</span><span class="o">=</span><span class="mh">256</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="w">	</span><span class="k">localparam</span><span class="w"> </span><span class="n">AWIDTH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">$clog2</span><span class="p">(</span><span class="n">MAX_DATA</span><span class="p">)</span>
<span class="linenos"> 5</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="k">input</span><span class="w"> </span><span class="n">en</span><span class="p">,</span><span class="w"> </span><span class="n">clk</span><span class="p">,</span><span class="w"> </span><span class="n">rst</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">	</span><span class="k">output</span><span class="w"> </span><span class="kt">reg</span><span class="w"> </span><span class="p">[</span><span class="n">AWIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="w"> </span><span class="n">addr</span>
<span class="linenos"> 7</span><span class="p">);</span>
<span class="linenos"> 8</span><span class="w">	</span><span class="k">initial</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="w">	</span><span class="c1">// async reset</span>
<span class="linenos">11</span><span class="w">	</span><span class="c1">// increment address when enabled</span>
<span class="linenos">12</span><span class="w">	</span><span class="k">always</span><span class="w"> </span><span class="p">@(</span><span class="k">posedge</span><span class="w"> </span><span class="n">clk</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">posedge</span><span class="w"> </span><span class="n">rst</span><span class="p">)</span>
<span class="linenos">13</span><span class="w">		</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
<span class="linenos">14</span><span class="w">			</span><span class="n">addr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<span class="linenos">15</span><span class="w">		</span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">en</span><span class="p">)</span><span class="w"> </span><span class="k">begin</span>
<span class="linenos">16</span><span class="w">			</span><span class="k">if</span><span class="w"> </span><span class="p">({</span><span class="m">&#39;0</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">}</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">MAX_DATA</span><span class="o">-</span><span class="mh">1</span><span class="p">)</span>
<span class="linenos">17</span><span class="w">				</span><span class="n">addr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mh">0</span><span class="p">;</span>
<span class="linenos">18</span><span class="w">			</span><span class="k">else</span>
<span class="linenos">19</span><span class="w">				</span><span class="n">addr</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mh">1</span><span class="p">;</span>
<span class="linenos">20</span><span class="w">		</span><span class="k">end</span>
<span class="linenos">21</span><span class="k">endmodule</span><span class="w"> </span><span class="c1">//addr_gen</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../cmd/hierarchy.html#cmd-hierarchy" title="check, expand and clean up design hierarchy"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">hierarchy</span></code></a> should always be the first command after the design has been
read.  By specifying the top module, <a class="reference internal" href="../cmd/hierarchy.html#cmd-hierarchy" title="check, expand and clean up design hierarchy"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">hierarchy</span></code></a> will also set the <code class="docutils literal notranslate"><span class="pre">(*</span> <span class="pre">top</span>
<span class="pre">*)</span></code> attribute on it.  This is used by other commands that need to know which
module is the top.</p>
</div>
<div class="literal-block-wrapper docutils container" id="hierarchy-output">
<div class="code-block-caption"><span class="caption-number">Listing 4 </span><span class="caption-text"><code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">hierarchy</span><span class="w"> </span><span class="na">-top</span><span class="w"> </span><span class="n">addr_gen</span></code> output</span><a class="headerlink" href="#hierarchy-output" title="Link to this code">¶</a></div>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> hierarchy -top addr_gen

<span class="go">2. Executing HIERARCHY pass (managing design hierarchy).</span>

<span class="go">3. Executing AST frontend in derive mode using pre-parsed AST for module `\addr_gen&#39;.</span>
<span class="go">Generating RTLIL representation for module `\addr_gen&#39;.</span>

<span class="go">3.1. Analyzing design hierarchy..</span>
<span class="go">Top module:  \addr_gen</span>

<span class="go">3.2. Analyzing design hierarchy..</span>
<span class="go">Top module:  \addr_gen</span>
<span class="go">Removing unused module `$abstract\fifo&#39;.</span>
<span class="go">Removing unused module `$abstract\addr_gen&#39;.</span>
<span class="go">Removed 2 unused modules.</span>
</pre></div>
</div>
</div>
<p>Our <code class="docutils literal notranslate"><span class="pre">addr_gen</span></code> circuit now looks like this:</p>
<figure class="align-default" id="addr-gen-hier">
<img alt="../_images/addr_gen_hier.svg" class="width-helper invert-helper" src="../_images/addr_gen_hier.svg" />
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">addr_gen</span></code> module after <a class="reference internal" href="../cmd/hierarchy.html#cmd-hierarchy" title="check, expand and clean up design hierarchy"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">hierarchy</span></code></a></span><a class="headerlink" href="#addr-gen-hier" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Simple operations like <code class="docutils literal notranslate"><span class="pre">addr</span> <span class="pre">+</span> <span class="pre">1</span></code> and <code class="docutils literal notranslate"><span class="pre">addr</span> <span class="pre">==</span> <span class="pre">MAX_DATA-1</span></code> can be extracted
from our <code class="docutils literal notranslate"><span class="pre">always</span> <span class="pre">&#64;</span></code> block in <a class="reference internal" href="#addr-gen-v"><span class="std std-ref">addr_gen module source</span></a>. This gives us the highlighted
<a class="reference internal" href="../cell/word_binary.html#binary.$add" title="binary::$add"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$add</span></code></a> and <a class="reference internal" href="../cell/word_binary.html#binary.$eq" title="binary::$eq"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$eq</span></code></a> cells we see. But control logic (like the <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">..</span> <span class="pre">else</span></code>) and
memory elements (like the <code class="docutils literal notranslate"><span class="pre">addr</span> <span class="pre">&lt;=</span> <span class="pre">0</span></code>) are not so straightforward.  These get
put into “processes”, shown in the schematic as <code class="docutils literal notranslate"><span class="pre">PROC</span></code>.  Note how the second
line refers to the line numbers of the start/end of the corresponding <code class="docutils literal notranslate"><span class="pre">always</span>
<span class="pre">&#64;</span></code> block.  In the case of an <code class="docutils literal notranslate"><span class="pre">initial</span></code> block, we instead see the <code class="docutils literal notranslate"><span class="pre">PROC</span></code>
referring to line 0.</p>
<p>To handle these, let us now introduce the next command: <a class="reference internal" href="../cmd/proc.html"><span class="doc">proc - translate processes to netlists</span></a>. <a class="reference internal" href="../cmd/proc.html#cmd-proc" title="translate processes to netlists"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">proc</span></code></a>
is a macro command like <a class="reference internal" href="../cmd/synth_ice40.html#cmd-synth_ice40" title="synthesis for iCE40 FPGAs"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">synth_ice40</span></code></a>.  Rather than modifying the design
directly, it instead calls a series of other commands.  In the case of <a class="reference internal" href="../cmd/proc.html#cmd-proc" title="translate processes to netlists"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">proc</span></code></a>,
these sub-commands work to convert the behavioral logic of processes into
multiplexers and registers.  Let’s see what happens when we run it.  For now, we
will call <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">proc</span><span class="w"> </span><span class="na">-noopt</span></code> to prevent some automatic optimizations which
would normally happen.</p>
<figure class="align-default" id="addr-gen-proc">
<img alt="../_images/addr_gen_proc.svg" class="width-helper invert-helper" src="../_images/addr_gen_proc.svg" />
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">addr_gen</span></code> module after <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">proc</span><span class="w"> </span><span class="na">-noopt</span></code></span><a class="headerlink" href="#addr-gen-proc" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>There are now a few new cells from our <code class="docutils literal notranslate"><span class="pre">always</span> <span class="pre">&#64;</span></code>, which have been
highlighted.  The <code class="docutils literal notranslate"><span class="pre">if</span></code> statements are now modeled with <a class="reference internal" href="../cell/word_mux.html#mux.$mux" title="mux::$mux"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mux</span></code></a> cells, while the
register uses an <a class="reference internal" href="../cell/word_reg.html#reg.$adff" title="reg::$adff"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$adff</span></code></a> cell.  If we look at the terminal output we can also
see all of the different <code class="docutils literal notranslate"><span class="pre">proc_*</span></code> commands being called.  We will look at each
of these in more detail in <a class="reference internal" href="../using_yosys/synthesis/proc.html"><span class="doc">Converting process blocks</span></a>.</p>
<p>Notice how in the top left of <a class="reference internal" href="#addr-gen-proc"><span class="std std-ref">addr_gen module after proc -noopt</span></a> we have a floating wire,
generated from the initial assignment of 0 to the <code class="docutils literal notranslate"><span class="pre">addr</span></code> wire.  However, this
initial assignment is not synthesizable, so this will need to be cleaned up
before we can generate the physical hardware.  We can do this now by calling
<a class="reference internal" href="../cmd/clean.html#cmd-clean" title="remove unused cells and wires"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">clean</span></code></a>.  We’re also going to call <a class="reference internal" href="../cmd/opt_expr.html#cmd-opt_expr" title="perform const folding and simple expression rewriting"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_expr</span></code></a> now, which would normally be
called at the end of <a class="reference internal" href="../cmd/proc.html#cmd-proc" title="translate processes to netlists"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">proc</span></code></a>.  We can call both commands at the same time by
separating them with a colon and space: <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">opt_expr</span><span class="o">;</span><span class="w"> </span><span class="k">clean</span></code>.</p>
<figure class="align-default" id="addr-gen-clean">
<img alt="../_images/addr_gen_clean.svg" class="width-helper invert-helper" src="../_images/addr_gen_clean.svg" />
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">addr_gen</span></code> module after <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">opt_expr</span><span class="o">;</span><span class="w"> </span><span class="k">clean</span></code></span><a class="headerlink" href="#addr-gen-clean" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>You may also notice that the highlighted <a class="reference internal" href="../cell/word_binary.html#binary.$eq" title="binary::$eq"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$eq</span></code></a> cell input of <code class="docutils literal notranslate"><span class="pre">255</span></code> has changed
to <code class="docutils literal notranslate"><span class="pre">8'11111111</span></code>.  Constant values are presented in the format
<code class="docutils literal notranslate"><span class="pre">&lt;bit_width&gt;'&lt;bits&gt;</span></code>, with 32-bit values instead using the decimal number.
This indicates that the constant input has been reduced from 32-bit wide to
8-bit wide.  This is a side-effect of running <a class="reference internal" href="../cmd/opt_expr.html#cmd-opt_expr" title="perform const folding and simple expression rewriting"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_expr</span></code></a>, which performs
constant folding and simple expression rewriting.    For more on why this
happens, refer to <a class="reference internal" href="../using_yosys/synthesis/opt.html"><span class="doc">Optimization passes</span></a> and the <a class="reference internal" href="../using_yosys/synthesis/opt.html#adv-opt-expr"><span class="std std-ref">section on
opt_expr</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../cmd/clean.html"><span class="doc">clean - remove unused cells and wires</span></a> can also be called with two semicolons after any command,
for example we could have called <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">opt_expr</span><span class="nc">;;</span></code> instead of
<code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">opt_expr</span><span class="o">;</span><span class="w"> </span><span class="k">clean</span></code>.  You may notice some scripts will end each line
with <code class="docutils literal notranslate"><span class="pre">;;</span></code>.  It is beneficial to run <a class="reference internal" href="../cmd/clean.html#cmd-clean" title="remove unused cells and wires"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">clean</span></code></a> before inspecting intermediate
products to remove disconnected parts of the circuit which have been left
over, and in some cases can reduce the processing required in subsequent
commands.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for</p>
<ul class="simple">
<li><p><a class="reference internal" href="../using_yosys/synthesis/proc.html"><span class="doc">Converting process blocks</span></a></p></li>
<li><p><a class="reference internal" href="../using_yosys/synthesis/opt.html"><span class="doc">Optimization passes</span></a></p></li>
</ul>
</div>
</section>
<section id="the-full-example">
<h3>The full example<a class="headerlink" href="#the-full-example" title="Link to this heading">¶</a></h3>
<p>Let’s now go back and check on our full design by using <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">hierarchy</span>
<span class="na">-check</span><span class="w"> </span><span class="na">-top</span><span class="w"> </span><span class="n">fifo</span></code>.  By passing the <code class="docutils literal notranslate"><span class="pre">-check</span></code> option there we are also telling
the <a class="reference internal" href="../cmd/hierarchy.html#cmd-hierarchy" title="check, expand and clean up design hierarchy"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">hierarchy</span></code></a> command that if the design includes any non-blackbox modules
without an implementation it should return an error.</p>
<p>Note that if we tried to run this command now then we would get an error.  This
is because we already removed all of the modules other than <code class="docutils literal notranslate"><span class="pre">addr_gen</span></code>.  We
could restart our shell session, but instead let’s use two new commands:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../cmd/design.html"><span class="doc">design - save, restore and reset current design</span></a>, and</p></li>
<li><p><a class="reference internal" href="../cmd/read_verilog.html"><span class="doc">read_verilog - read modules from Verilog file</span></a>.</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-number">Listing 5 </span><span class="caption-text">reloading <code class="file docutils literal notranslate"><span class="pre">fifo.v</span></code> and running <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">hierarchy</span><span class="w"> </span><span class="na">-check</span><span class="w"> </span><span class="na">-top</span><span class="w"> </span><span class="n">fifo</span></code></span><a class="headerlink" href="#id7" title="Link to this code">¶</a></div>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> design -reset

<span class="gp">yosys&gt;</span> read_verilog fifo.v

<span class="go">11. Executing Verilog-2005 frontend: fifo.v</span>
<span class="go">Parsing Verilog input from `fifo.v&#39; to AST representation.</span>
<span class="go">Generating RTLIL representation for module `\addr_gen&#39;.</span>
<span class="go">Generating RTLIL representation for module `\fifo&#39;.</span>
<span class="go">Successfully finished Verilog frontend.</span>

<span class="gp">yosys&gt;</span> hierarchy -check -top fifo

<span class="go">12. Executing HIERARCHY pass (managing design hierarchy).</span>

<span class="go">12.1. Analyzing design hierarchy..</span>
<span class="go">Top module:  \fifo</span>
<span class="go">Used module:     \addr_gen</span>
<span class="go">Parameter \MAX_DATA = 256</span>

<span class="go">12.2. Executing AST frontend in derive mode using pre-parsed AST for module `\addr_gen&#39;.</span>
<span class="go">Parameter \MAX_DATA = 256</span>
<span class="go">Generating RTLIL representation for module `$paramod\addr_gen\MAX_DATA=s32&#39;00000000000000000000000100000000&#39;.</span>
<span class="go">Parameter \MAX_DATA = 256</span>
<span class="go">Found cached RTLIL representation for module `$paramod\addr_gen\MAX_DATA=s32&#39;00000000000000000000000100000000&#39;.</span>

<span class="go">12.3. Analyzing design hierarchy..</span>
<span class="go">Top module:  \fifo</span>
<span class="go">Used module:     $paramod\addr_gen\MAX_DATA=s32&#39;00000000000000000000000100000000</span>

<span class="go">12.4. Analyzing design hierarchy..</span>
<span class="go">Top module:  \fifo</span>
<span class="go">Used module:     $paramod\addr_gen\MAX_DATA=s32&#39;00000000000000000000000100000000</span>
<span class="go">Removing unused module `\addr_gen&#39;.</span>
<span class="go">Removed 1 unused modules.</span>
</pre></div>
</div>
</div>
<p>Notice how this time we didn’t see any of those <code class="docutils literal notranslate"><span class="pre">$abstract</span></code> modules?  That’s
because when we ran <code class="docutils literal notranslate"><span class="pre">yosys</span> <span class="pre">fifo.v</span></code>, the first command Yosys called was
<code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">read_verilog</span><span class="w"> </span><span class="na">-defer</span><span class="w"> </span><span class="n">fifo.v</span></code>.  The <code class="docutils literal notranslate"><span class="pre">-defer</span></code> option there tells
<a class="reference internal" href="../cmd/read_verilog.html#cmd-read_verilog" title="read modules from Verilog file"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">read_verilog</span></code></a> only read the abstract syntax tree and defer actual compilation
to a later <a class="reference internal" href="../cmd/hierarchy.html#cmd-hierarchy" title="check, expand and clean up design hierarchy"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">hierarchy</span></code></a> command. This is useful in cases where the default
parameters of modules yield invalid code which is not synthesizable. This is why
Yosys defers compilation automatically and is one of the reasons why hierarchy
should always be the first command after loading the design.  If we know that
our design won’t run into this issue, we can skip the <code class="docutils literal notranslate"><span class="pre">-defer</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The number before a command’s output increments with each command run.  Don’t
worry if your numbers don’t match ours!  The output you are seeing comes from
the same script that was used to generate the images in this document,
included in the source as <code class="file docutils literal notranslate"><span class="pre">fifo.ys</span></code>. There are extra commands being run
which you don’t see, but feel free to try them yourself, or play around with
different commands.  You can always start over with a clean slate by calling
<code class="docutils literal notranslate"><span class="pre">exit</span></code> or hitting <kbd class="kbd docutils literal notranslate">ctrl</kbd>+<kbd class="kbd docutils literal notranslate">d</kbd> (i.e. EOF) and re-launching the Yosys
interactive terminal.  <kbd class="kbd docutils literal notranslate">ctrl</kbd>+<kbd class="kbd docutils literal notranslate">c</kbd> (i.e. SIGINT) will also end the terminal
session but will return an error code rather than exiting gracefully.</p>
</div>
<p>We can also run <a class="reference internal" href="../cmd/proc.html#cmd-proc" title="translate processes to netlists"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">proc</span></code></a> now to finish off the full <a class="reference internal" href="#synth-begin"><span class="std std-ref">begin section</span></a>. Because
the design schematic is quite large, we will be showing just the data path for
the <code class="docutils literal notranslate"><span class="pre">rdata</span></code> output.  If you would like to see the entire design for yourself,
you can do so with <a class="reference internal" href="../cmd/show.html"><span class="doc">show - generate schematics using graphviz</span></a>.  Note that the <a class="reference internal" href="../cmd/show.html#cmd-show" title="generate schematics using graphviz"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">show</span></code></a> command only works
with a single module, so you may need to call it with <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">show</span><span class="w"> </span><span class="n">fifo</span></code>.
<a class="reference internal" href="scripting_intro.html#show-intro"><span class="std std-ref">Displaying schematics</span></a> section in <a class="reference internal" href="scripting_intro.html"><span class="doc">Scripting in Yosys</span></a> has more on
how to use <a class="reference internal" href="../cmd/show.html#cmd-show" title="generate schematics using graphviz"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">show</span></code></a>.</p>
<figure class="align-default" id="rdata-proc">
<img alt="../_images/rdata_proc.svg" class="width-helper invert-helper" src="../_images/rdata_proc.svg" />
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="../cmd/proc.html#cmd-proc" title="translate processes to netlists"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">proc</span></code></a></span><a class="headerlink" href="#rdata-proc" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The highlighted <code class="docutils literal notranslate"><span class="pre">fifo_reader</span></code> block contains an instance of the
<a class="reference internal" href="#addr-gen-proc"><span class="std std-ref">addr_gen module after proc -noopt</span></a> that we looked at earlier.  Notice how the type is shown as
<code class="docutils literal notranslate"><span class="pre">$paramod\\addr_gen\\MAX_DATA=s32'...</span></code>.  This is a “parametric module”: an
instance of the <code class="docutils literal notranslate"><span class="pre">addr_gen</span></code> module with the <code class="docutils literal notranslate"><span class="pre">MAX_DATA</span></code> parameter set to the
given value.</p>
<p>The other highlighted block is a <a class="reference internal" href="../cell/word_mem.html#mem.$memrd" title="mem::$memrd"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$memrd</span></code></a> cell.  At this stage of synthesis we
don’t yet know what type of memory is going to be implemented, but we <em>do</em> know
that <code class="docutils literal notranslate"><span class="pre">rdata</span> <span class="pre">&lt;=</span> <span class="pre">data[raddr];</span></code> could be implemented as a read from memory. Note
that the <a class="reference internal" href="../cell/word_mem.html#mem.$memrd" title="mem::$memrd"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$memrd</span></code></a> cell here is asynchronous, with both the clock and enable
signal undefined; shown with the <code class="docutils literal notranslate"><span class="pre">1'x</span></code> inputs.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for
<a class="reference internal" href="../using_yosys/synthesis/proc.html"><span class="doc">Converting process blocks</span></a></p>
</div>
</section>
</section>
<section id="flattening">
<h2>Flattening<a class="headerlink" href="#flattening" title="Link to this heading">¶</a></h2>
<p>At this stage of a synthesis flow there are a few other commands we could run.
In <a class="reference internal" href="../cmd/synth_ice40.html#cmd-synth_ice40" title="synthesis for iCE40 FPGAs"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">synth_ice40</span></code></a> we get these:</p>
<div class="literal-block-wrapper docutils container" id="synth-flatten">
<div class="code-block-caption"><span class="caption-number">Listing 6 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">flatten</span></code> section</span><a class="headerlink" href="#synth-flatten" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">flatten</span>
<span class="k">tribuf</span><span class="w"> </span><span class="na">-logic</span>
<span class="k">deminout</span>
</pre></div>
</div>
</div>
<p>First off is <a class="reference internal" href="../cmd/flatten.html#cmd-flatten" title="flatten design"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">flatten</span></code></a>.  Flattening the design like this can allow for
optimizations between modules which would otherwise be missed.  Let’s run
<code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">flatten</span><span class="nc">;;</span></code> on our design.</p>
<div class="literal-block-wrapper docutils container" id="flat-clean">
<div class="code-block-caption"><span class="caption-number">Listing 7 </span><span class="caption-text">output of <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">flatten</span><span class="nc">;;</span></code></span><a class="headerlink" href="#flat-clean" title="Link to this code">¶</a></div>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> flatten

<span class="go">15. Executing FLATTEN pass (flatten design).</span>
<span class="go">Deleting now unused module $paramod\addr_gen\MAX_DATA=s32&#39;00000000000000000000000100000000.</span>
<span class="gp">&lt;suppressed ~2 debug messages&gt;</span>

<span class="gp">yosys&gt;</span> clean
<span class="go">Removed 3 unused cells and 28 unused wires.</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-flat">
<img alt="../_images/rdata_flat.svg" class="width-helper invert-helper" src="../_images/rdata_flat.svg" />
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">flatten</span><span class="nc">;;</span></code></span><a class="headerlink" href="#rdata-flat" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The pieces have moved around a bit, but we can see <a class="reference internal" href="#addr-gen-proc"><span class="std std-ref">addr_gen module after proc -noopt</span></a> from
earlier has replaced the <code class="docutils literal notranslate"><span class="pre">fifo_reader</span></code> block in <a class="reference internal" href="#rdata-proc"><span class="std std-ref">rdata output after proc</span></a>.  We can
also see that the <code class="docutils literal notranslate"><span class="pre">addr</span></code> output has been renamed to <code class="file docutils literal notranslate"><span class="pre">fifo_reader.addr</span></code>
and merged with the <code class="docutils literal notranslate"><span class="pre">raddr</span></code> wire feeding into the <a class="reference internal" href="../cell/word_mem.html#mem.$memrd" title="mem::$memrd"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$memrd</span></code></a> cell.  This wire
merging happened during the call to <a class="reference internal" href="../cmd/clean.html#cmd-clean" title="remove unused cells and wires"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">clean</span></code></a> which we can see in the
<a class="reference internal" href="#flat-clean"><span class="std std-ref">output of flatten;;</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="../cmd/flatten.html#cmd-flatten" title="flatten design"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">flatten</span></code></a> and <a class="reference internal" href="../cmd/clean.html#cmd-clean" title="remove unused cells and wires"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">clean</span></code></a> would normally be combined into a
single <code class="code highlight yoterm doscon docutils literal highlight-doscon"><span class="gp">yosys&gt;</span> flatten;;</code> output, but they appear separately here as
a side effect of using <a class="reference internal" href="../cmd/echo.html#cmd-echo" title="turning echoing back of commands on and off"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">echo</span></code></a> for generating the terminal style
output.</p>
</div>
<p>Depending on the target architecture, this stage of synthesis might also see
commands such as <a class="reference internal" href="../cmd/tribuf.html#cmd-tribuf" title="infer tri-state buffers"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">tribuf</span></code></a> with the <code class="docutils literal notranslate"><span class="pre">-logic</span></code> option and <a class="reference internal" href="../cmd/deminout.html#cmd-deminout" title="demote inout ports to input or output"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">deminout</span></code></a>.  These
remove tristate and inout constructs respectively, replacing them with logic
suitable for mapping to an FPGA.  Since we do not have any such constructs in
our example running these commands does not change our design.</p>
</section>
<section id="the-coarse-grain-representation">
<h2>The coarse-grain representation<a class="headerlink" href="#the-coarse-grain-representation" title="Link to this heading">¶</a></h2>
<p>At this stage, the design is in coarse-grain representation.  It still looks
recognizable, and cells are word-level operators with parametrizable width. This
is the stage of synthesis where we do things like const propagation, expression
rewriting, and trimming unused parts of wires.</p>
<p>This is also where we convert our FSMs and hard blocks like DSPs or memories.
Such elements have to be inferred from patterns in the design and there are
special passes for each.  Detection of these patterns can also be affected by
optimizations and other transformations done previously.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the iCE40 flow had a <a class="reference internal" href="#synth-flatten"><span class="std std-ref">flatten section</span></a> and put <a class="reference internal" href="../cmd/proc.html#cmd-proc" title="translate processes to netlists"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">proc</span></code></a> in the
<a class="reference internal" href="#synth-begin"><span class="std std-ref">begin section</span></a>, some synthesis scripts will instead include these in this
section.</p>
</div>
<section id="part-1">
<h3>Part 1<a class="headerlink" href="#part-1" title="Link to this heading">¶</a></h3>
<p>In the iCE40 flow, we start with the following commands:</p>
<div class="literal-block-wrapper docutils container" id="synth-coarse1">
<div class="code-block-caption"><span class="caption-number">Listing 8 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">coarse</span></code> section (part 1)</span><a class="headerlink" href="#synth-coarse1" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">opt_expr</span>
<span class="k">opt_clean</span>
<span class="k">check</span>
<span class="k">opt</span><span class="w"> </span><span class="na">-nodffe</span><span class="w"> </span><span class="na">-nosdff</span>
<span class="k">fsm</span>
<span class="k">opt</span>
</pre></div>
</div>
</div>
<p>We’ve already come across <a class="reference internal" href="../cmd/opt_expr.html#cmd-opt_expr" title="perform const folding and simple expression rewriting"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_expr</span></code></a>, and <a class="reference internal" href="../cmd/opt_clean.html#cmd-opt_clean" title="remove unused cells and wires"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_clean</span></code></a> is the same as <a class="reference internal" href="../cmd/clean.html#cmd-clean" title="remove unused cells and wires"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">clean</span></code></a> but
with more verbose output.  The <a class="reference internal" href="../cmd/check.html#cmd-check" title="check for obvious problems in the design"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">check</span></code></a> pass identifies a few obvious problems
which will cause errors later.  Calling it here lets us fail faster rather than
wasting time on something we know is impossible.</p>
<p>Next up is <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">opt</span><span class="w"> </span><span class="na">-nodffe</span><span class="w"> </span><span class="na">-nosdff</span></code> performing a set of simple
optimizations on the design.  This command also ensures that only a specific
subset of FF types are included, in preparation for the next command:
<a class="reference internal" href="../cmd/fsm.html"><span class="doc">fsm - extract and optimize finite state machines</span></a>.  Both <a class="reference internal" href="../cmd/opt.html#cmd-opt" title="perform simple optimizations"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt</span></code></a> and <a class="reference internal" href="../cmd/fsm.html#cmd-fsm" title="extract and optimize finite state machines"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">fsm</span></code></a> are macro commands which are explored in
more detail in <a class="reference internal" href="../using_yosys/synthesis/opt.html"><span class="doc">Optimization passes</span></a> and
<a class="reference internal" href="../using_yosys/synthesis/fsm.html"><span class="doc">FSM handling</span></a> respectively.</p>
<p>Up until now, the data path for <code class="docutils literal notranslate"><span class="pre">rdata</span></code> has remained the same since
<a class="reference internal" href="#rdata-flat"><span class="std std-ref">rdata output after flatten;;</span></a>.  However the next call to <a class="reference internal" href="../cmd/opt.html#cmd-opt" title="perform simple optimizations"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt</span></code></a> does cause a change.
Specifically, the call to <a class="reference internal" href="../cmd/opt_dff.html#cmd-opt_dff" title="perform DFF optimizations"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_dff</span></code></a> without the <code class="docutils literal notranslate"><span class="pre">-nodffe</span> <span class="pre">-nosdff</span></code> options is
able to fold one of the <a class="reference internal" href="../cell/word_mux.html#mux.$mux" title="mux::$mux"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mux</span></code></a> cells into the <a class="reference internal" href="../cell/word_reg.html#reg.$adff" title="reg::$adff"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$adff</span></code></a> to form an <a class="reference internal" href="../cell/word_reg.html#reg.$adffe" title="reg::$adffe"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$adffe</span></code></a> cell;
highlighted below:</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-number">Listing 9 </span><span class="caption-text">output of <a class="reference internal" href="../cmd/opt_dff.html#cmd-opt_dff" title="perform DFF optimizations"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_dff</span></code></a></span><a class="headerlink" href="#id8" title="Link to this code">¶</a></div>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> opt_dff

<span class="go">17. Executing OPT_DFF pass (perform DFF optimizations).</span>
<span class="go">Adding EN signal on $procdff$59 ($adff) from module fifo (D = $0\count[8:0], Q = \count).</span>
<span class="go">Adding EN signal on $flatten\fifo_writer.$procdff$66 ($adff) from module fifo (D = $flatten\fifo_writer.$procmux$53_Y, Q = \fifo_writer.addr).</span>
<span class="go">Adding EN signal on $flatten\fifo_reader.$procdff$66 ($adff) from module fifo (D = $flatten\fifo_reader.$procmux$53_Y, Q = \fifo_reader.addr).</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-adffe">
<img alt="../_images/rdata_adffe.svg" class="width-helper invert-helper" src="../_images/rdata_adffe.svg" />
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="../cmd/opt_dff.html#cmd-opt_dff" title="perform DFF optimizations"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_dff</span></code></a></span><a class="headerlink" href="#rdata-adffe" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for</p>
<ul class="simple">
<li><p><a class="reference internal" href="../using_yosys/synthesis/fsm.html"><span class="doc">FSM handling</span></a></p></li>
<li><p><a class="reference internal" href="../using_yosys/synthesis/opt.html"><span class="doc">Optimization passes</span></a></p></li>
</ul>
</div>
</section>
<section id="part-2">
<h3>Part 2<a class="headerlink" href="#part-2" title="Link to this heading">¶</a></h3>
<p>The next group of commands performs a series of optimizations:</p>
<div class="literal-block-wrapper docutils container" id="synth-coarse2">
<div class="code-block-caption"><span class="caption-number">Listing 10 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">coarse</span></code> section (part 2)</span><a class="headerlink" href="#synth-coarse2" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">wreduce</span>
<span class="k">peepopt</span>
<span class="k">opt_clean</span>
<span class="k">share</span>
<span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/cmp2lut.v</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">LUT_WIDTH</span><span class="o">=</span><span class="m">4</span>
<span class="k">opt_expr</span>
<span class="k">opt_clean</span>
<span class="k">memory_dff</span><span class="w"> </span><span class="o">[</span><span class="na">-no-rw-check</span><span class="o">]</span>
</pre></div>
</div>
</div>
<p>First up is <a class="reference internal" href="../cmd/wreduce.html"><span class="doc">wreduce - reduce the word size of operations if possible</span></a>.  If we run this we get the following:</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-number">Listing 11 </span><span class="caption-text">output of <a class="reference internal" href="../cmd/wreduce.html#cmd-wreduce" title="reduce the word size of operations if possible"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">wreduce</span></code></a></span><a class="headerlink" href="#id9" title="Link to this code">¶</a></div>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> wreduce

<span class="go">19. Executing WREDUCE pass (reducing word size of cells).</span>
<span class="go">Removed top 31 bits (of 32) from port B of cell fifo.$add$fifo.v:66$29 ($add).</span>
<span class="go">Removed top 23 bits (of 32) from port Y of cell fifo.$add$fifo.v:66$29 ($add).</span>
<span class="go">Removed top 31 bits (of 32) from port B of cell fifo.$sub$fifo.v:68$32 ($sub).</span>
<span class="go">Removed top 23 bits (of 32) from port Y of cell fifo.$sub$fifo.v:68$32 ($sub).</span>
<span class="go">Removed top 1 bits (of 2) from port B of cell fifo.$auto$opt_dff.cc:195:make_patterns_logic$72 ($ne).</span>
<span class="go">Removed cell fifo.$flatten\fifo_writer.$procmux$55 ($mux).</span>
<span class="go">Removed top 31 bits (of 32) from port B of cell fifo.$flatten\fifo_writer.$add$fifo.v:19$36 ($add).</span>
<span class="go">Removed top 24 bits (of 32) from port Y of cell fifo.$flatten\fifo_writer.$add$fifo.v:19$36 ($add).</span>
<span class="go">Removed cell fifo.$flatten\fifo_reader.$procmux$55 ($mux).</span>
<span class="go">Removed top 31 bits (of 32) from port B of cell fifo.$flatten\fifo_reader.$add$fifo.v:19$36 ($add).</span>
<span class="go">Removed top 24 bits (of 32) from port Y of cell fifo.$flatten\fifo_reader.$add$fifo.v:19$36 ($add).</span>
<span class="go">Removed top 23 bits (of 32) from wire fifo.$add$fifo.v:66$29_Y.</span>
<span class="go">Removed top 24 bits (of 32) from wire fifo.$flatten\fifo_reader.$add$fifo.v:19$36_Y.</span>
<span class="go">Removed top 24 bits (of 32) from wire fifo.$flatten\fifo_writer.$add$fifo.v:19$36_Y.</span>

<span class="gp">yosys&gt;</span> show -notitle -format dot -prefix rdata_wreduce o:rdata %ci*

<span class="go">20. Generating Graphviz representation of design.</span>
<span class="go">Writing dot description to `rdata_wreduce.dot&#39;.</span>
<span class="go">Dumping selected parts of module fifo to page 1.</span>

<span class="gp">yosys&gt;</span> opt_clean

<span class="go">21. Executing OPT_CLEAN pass (remove unused cells and wires).</span>
<span class="go">Finding unused cells or wires in module \fifo..</span>
<span class="go">Removed 0 unused cells and 5 unused wires.</span>
<span class="gp">&lt;suppressed ~1 debug messages&gt;</span>

<span class="gp">yosys&gt;</span> memory_dff

<span class="go">22. Executing MEMORY_DFF pass (merging $dff cells to $memrd).</span>
<span class="go">Checking read port `\data&#39;[0] in module `\fifo&#39;: merging output FF to cell.</span>
<span class="go">    Write port 0: non-transparent.</span>
</pre></div>
</div>
</div>
<p>Looking at the data path for <code class="docutils literal notranslate"><span class="pre">rdata</span></code>, the most relevant of these width
reductions are the ones affecting <code class="docutils literal notranslate"><span class="pre">fifo.$flatten\fifo_reader.$add$fifo.v</span></code>.
That is the <a class="reference internal" href="../cell/word_binary.html#binary.$add" title="binary::$add"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$add</span></code></a> cell incrementing the fifo_reader address.  We can look at
the schematic and see the output of that cell has now changed.</p>
<figure class="align-default" id="rdata-wreduce">
<img alt="../_images/rdata_wreduce.svg" class="width-helper invert-helper" src="../_images/rdata_wreduce.svg" />
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="../cmd/wreduce.html#cmd-wreduce" title="reduce the word size of operations if possible"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">wreduce</span></code></a></span><a class="headerlink" href="#rdata-wreduce" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The next two (new) commands are <a class="reference internal" href="../cmd/peepopt.html"><span class="doc">peepopt - collection of peephole optimizers</span></a> and <a class="reference internal" href="../cmd/share.html"><span class="doc">share - perform sat-based resource sharing</span></a>.
Neither of these affect our design, and they’re explored in more detail in
<a class="reference internal" href="../using_yosys/synthesis/opt.html"><span class="doc">Optimization passes</span></a>, so let’s skip over them.  <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">techmap</span>
<span class="na">-map</span><span class="w"> </span><span class="nc">+/cmp2lut.v</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">LUT_WIDTH</span><span class="o">=</span><span class="m">4</span></code> optimizes certain comparison operators by
converting them to LUTs instead.  The usage of <a class="reference internal" href="../cmd/techmap.html#cmd-techmap" title="generic technology mapper"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">techmap</span></code></a> is explored more in
<a class="reference internal" href="../using_yosys/synthesis/techmap_synth.html"><span class="doc">Technology mapping</span></a>.</p>
<p>Our next command to run is
<a class="reference internal" href="../cmd/memory_dff.html"><span class="doc">memory_dff - merge input/output DFFs into memory read ports</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-number">Listing 12 </span><span class="caption-text">output of <a class="reference internal" href="../cmd/memory_dff.html#cmd-memory_dff" title="merge input/output DFFs into memory read ports"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_dff</span></code></a></span><a class="headerlink" href="#id10" title="Link to this code">¶</a></div>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> memory_dff

<span class="go">22. Executing MEMORY_DFF pass (merging $dff cells to $memrd).</span>
<span class="go">Checking read port `\data&#39;[0] in module `\fifo&#39;: merging output FF to cell.</span>
<span class="go">    Write port 0: non-transparent.</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-memrdv2">
<img alt="../_images/rdata_memrdv2.svg" class="width-helper invert-helper" src="../_images/rdata_memrdv2.svg" />
<figcaption>
<p><span class="caption-number">Fig. 9 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="../cmd/memory_dff.html#cmd-memory_dff" title="merge input/output DFFs into memory read ports"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_dff</span></code></a></span><a class="headerlink" href="#rdata-memrdv2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>As the title suggests, <a class="reference internal" href="../cmd/memory_dff.html#cmd-memory_dff" title="merge input/output DFFs into memory read ports"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_dff</span></code></a> has merged the output <a class="reference internal" href="../cell/word_reg.html#reg.$dff" title="reg::$dff"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$dff</span></code></a> into the
<a class="reference internal" href="../cell/word_mem.html#mem.$memrd" title="mem::$memrd"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$memrd</span></code></a> cell and converted it to a <a class="reference internal" href="../cell/word_mem.html#mem.$memrd_v2" title="mem::$memrd_v2"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$memrd_v2</span></code></a> (highlighted).  This has also
connected the <code class="docutils literal notranslate"><span class="pre">CLK</span></code> port to the <code class="docutils literal notranslate"><span class="pre">clk</span></code> input as it is now a synchronous
memory read with appropriate enable (<code class="docutils literal notranslate"><span class="pre">EN=1'1</span></code>) and reset (<code class="docutils literal notranslate"><span class="pre">ARST=1'0</span></code> and
<code class="docutils literal notranslate"><span class="pre">SRST=1'0</span></code>) inputs.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for</p>
<ul class="simple">
<li><p><a class="reference internal" href="../using_yosys/synthesis/opt.html"><span class="doc">Optimization passes</span></a></p></li>
<li><p><a class="reference internal" href="../using_yosys/synthesis/techmap_synth.html"><span class="doc">Technology mapping</span></a></p></li>
<li><p><a class="reference internal" href="../using_yosys/synthesis/memory.html"><span class="doc">Memory handling</span></a></p></li>
</ul>
</div>
</section>
<section id="part-3">
<h3>Part 3<a class="headerlink" href="#part-3" title="Link to this heading">¶</a></h3>
<p>The third part of the <a class="reference internal" href="../cmd/synth_ice40.html#cmd-synth_ice40" title="synthesis for iCE40 FPGAs"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">synth_ice40</span></code></a> flow is a series of commands for mapping to
DSPs.  By default, the iCE40 flow will not map to the hardware DSP blocks and
will only be performed if called with the <code class="docutils literal notranslate"><span class="pre">-dsp</span></code> flag: <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">synth_ice40</span>
<span class="na">-dsp</span></code>.  While our example has nothing that could be mapped to DSPs we can still
take a quick look at the commands here and describe what they do.</p>
<div class="literal-block-wrapper docutils container" id="synth-coarse3">
<div class="code-block-caption"><span class="caption-number">Listing 13 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">coarse</span></code> section (part 3)</span><a class="headerlink" href="#synth-coarse3" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">wreduce</span><span class="w"> </span><span class="kt">t:</span><span class="nb">$mul</span>
<span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/mul2dsp.v</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/ice40/dsp_map.v</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">DSP_A_MAXWIDTH</span><span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">DSP_B_MAXWIDTH</span><span class="o">=</span><span class="m">16</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">DSP_A_MINWIDTH</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">DSP_B_MINWIDTH</span><span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">DSP_Y_MINWIDTH</span><span class="o">=</span><span class="m">11</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">DSP_NAME</span><span class="o">=</span><span class="nb">$__MUL16X16</span><span class="w">    </span><span class="c1">(if -dsp)</span>
<span class="k">select</span><span class="w"> </span><span class="kt">a:</span><span class="n">mul2dsp</span><span class="w">                  </span><span class="c1">(if -dsp)</span>
<span class="k">setattr</span><span class="w"> </span><span class="na">-unset</span><span class="w"> </span><span class="n">mul2dsp</span><span class="w">            </span><span class="c1">(if -dsp)</span>
<span class="k">opt_expr</span><span class="w"> </span><span class="na">-fine</span><span class="w">                    </span><span class="c1">(if -dsp)</span>
<span class="k">wreduce</span><span class="w">                           </span><span class="c1">(if -dsp)</span>
<span class="k">select</span><span class="w"> </span><span class="na">-clear</span><span class="w">                     </span><span class="c1">(if -dsp)</span>
<span class="k">ice40_dsp</span><span class="w">                         </span><span class="c1">(if -dsp)</span>
<span class="k">chtype</span><span class="w"> </span><span class="na">-set</span><span class="w"> </span><span class="nb">$mul</span><span class="w"> </span><span class="kt">t:</span><span class="nb">$__soft_mul</span><span class="w">    </span><span class="c1">(if -dsp)</span>
</pre></div>
</div>
</div>
<p><code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">wreduce</span><span class="w"> </span><span class="kt">t:</span><span class="nb">$mul</span></code> performs width reduction again, this time targetting
only cells of type <a class="reference internal" href="../cell/word_binary.html#binary.$mul" title="binary::$mul"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mul</span></code></a>.  <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/mul2dsp.v</span><span class="w"> </span><span class="na">-map</span>
<span class="c">+/</span><span class="k">ice40</span><span class="o">/</span><span class="n">dsp_map.v</span><span class="w"> </span><span class="c">...</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">DSP_NAME</span><span class="o">=</span><span class="nb">$__MUL16X16</span></code> uses <a class="reference internal" href="../cmd/techmap.html#cmd-techmap" title="generic technology mapper"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">techmap</span></code></a> to map <a class="reference internal" href="../cell/word_binary.html#binary.$mul" title="binary::$mul"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mul</span></code></a>
cells to <code class="docutils literal notranslate"><span class="pre">$__MUL16X16</span></code> which are, in turn, mapped to the iCE40 <code class="docutils literal notranslate"><span class="pre">SB_MAC16</span></code>.
Any multipliers which aren’t compatible with conversion to <code class="docutils literal notranslate"><span class="pre">$__MUL16X16</span></code> are
relabelled to <code class="docutils literal notranslate"><span class="pre">$__soft_mul</span></code> before <a class="reference internal" href="../cmd/chtype.html#cmd-chtype" title="change type of cells in the design"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">chtype</span></code></a> changes them back to <a class="reference internal" href="../cell/word_binary.html#binary.$mul" title="binary::$mul"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mul</span></code></a>.</p>
<p>During the mul2dsp conversion, some of the intermediate signals are marked with
the attribute <code class="docutils literal notranslate"><span class="pre">mul2dsp</span></code>.  By calling <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">select</span><span class="w"> </span><span class="kt">a:</span><span class="n">mul2dsp</span></code> we restrict
the following commands to only operate on the cells and wires used for these
signals.  <a class="reference internal" href="../cmd/setattr.html#cmd-setattr" title="set/unset attributes on objects"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">setattr</span></code></a> removes the now unnecessary <code class="docutils literal notranslate"><span class="pre">mul2dsp</span></code> attribute.
<a class="reference internal" href="../cmd/opt_expr.html#cmd-opt_expr" title="perform const folding and simple expression rewriting"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_expr</span></code></a> we’ve already come across for const folding and simple expression
rewriting, the <code class="docutils literal notranslate"><span class="pre">-fine</span></code> option just enables more fine-grain optimizations.
Then we perform width reduction a final time and clear the selection.</p>
<p>Finally we have <a class="reference internal" href="../cmd/ice40_dsp.html#cmd-ice40_dsp" title="iCE40: map multipliers"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">ice40_dsp</span></code></a>: similar to the <a class="reference internal" href="../cmd/memory_dff.html#cmd-memory_dff" title="merge input/output DFFs into memory read ports"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_dff</span></code></a> command we saw in the
previous section, this merges any surrounding registers into the <code class="docutils literal notranslate"><span class="pre">SB_MAC16</span></code>
cell.  This includes not just the input/output registers, but also pipeline
registers and even a post-adder where applicable: turning a multiply + add into
a single multiply-accumulate.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for
<a class="reference internal" href="../using_yosys/synthesis/techmap_synth.html"><span class="doc">Technology mapping</span></a></p>
</div>
</section>
<section id="part-4">
<h3>Part 4<a class="headerlink" href="#part-4" title="Link to this heading">¶</a></h3>
<p>That brings us to the fourth and final part for the iCE40 synthesis flow:</p>
<div class="literal-block-wrapper docutils container" id="synth-coarse4">
<div class="code-block-caption"><span class="caption-number">Listing 14 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">coarse</span></code> section (part 4)</span><a class="headerlink" href="#synth-coarse4" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">alumacc</span>
<span class="k">opt</span>
<span class="k">memory</span><span class="w"> </span><span class="na">-nomap</span><span class="w"> </span><span class="o">[</span><span class="na">-no-rw-check</span><span class="o">]</span>
<span class="k">opt_clean</span>
</pre></div>
</div>
</div>
<p>Where before each type of arithmetic operation had its own cell, e.g. <a class="reference internal" href="../cell/word_binary.html#binary.$add" title="binary::$add"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$add</span></code></a>, we
now want to extract these into <a class="reference internal" href="../cell/word_arith.html#arith.$alu" title="Arithmetic logic unit"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$alu</span></code></a> and <a class="reference internal" href="../cell/word_arith.html#arith.$macc_v2" title="arith::$macc_v2"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$macc_v2</span></code></a> cells which can help identify
opportunities for reusing logic.  We do this by running <a class="reference internal" href="../cmd/alumacc.html#cmd-alumacc" title="extract ALU and MACC cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">alumacc</span></code></a>, which we can
see produce the following changes in our example design:</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-number">Listing 15 </span><span class="caption-text">output of <a class="reference internal" href="../cmd/alumacc.html#cmd-alumacc" title="extract ALU and MACC cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">alumacc</span></code></a></span><a class="headerlink" href="#id11" title="Link to this code">¶</a></div>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> alumacc

<span class="go">24. Executing ALUMACC pass (create $alu and $macc cells).</span>
<span class="go">Extracting $alu and $macc cells in module fifo:</span>
<span class="go">  creating $macc model for $add$fifo.v:66$29 ($add).</span>
<span class="go">  creating $macc model for $flatten\fifo_reader.$add$fifo.v:19$36 ($add).</span>
<span class="go">  creating $macc model for $flatten\fifo_writer.$add$fifo.v:19$36 ($add).</span>
<span class="go">  creating $macc model for $sub$fifo.v:68$32 ($sub).</span>
<span class="go">  creating $alu model for $macc $sub$fifo.v:68$32.</span>
<span class="go">  creating $alu model for $macc $flatten\fifo_writer.$add$fifo.v:19$36.</span>
<span class="go">  creating $alu model for $macc $flatten\fifo_reader.$add$fifo.v:19$36.</span>
<span class="go">  creating $alu model for $macc $add$fifo.v:66$29.</span>
<span class="go">  creating $alu cell for $add$fifo.v:66$29: $auto$alumacc.cc:495:replace_alu$87</span>
<span class="go">  creating $alu cell for $flatten\fifo_reader.$add$fifo.v:19$36: $auto$alumacc.cc:495:replace_alu$90</span>
<span class="go">  creating $alu cell for $flatten\fifo_writer.$add$fifo.v:19$36: $auto$alumacc.cc:495:replace_alu$93</span>
<span class="go">  creating $alu cell for $sub$fifo.v:68$32: $auto$alumacc.cc:495:replace_alu$96</span>
<span class="go">  created 4 $alu and 0 $macc cells.</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-alumacc">
<img alt="../_images/rdata_alumacc.svg" class="width-helper invert-helper" src="../_images/rdata_alumacc.svg" />
<figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="../cmd/alumacc.html#cmd-alumacc" title="extract ALU and MACC cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">alumacc</span></code></a></span><a class="headerlink" href="#rdata-alumacc" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Once these cells have been inserted, the call to <a class="reference internal" href="../cmd/opt.html#cmd-opt" title="perform simple optimizations"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt</span></code></a> can combine cells which
are now identical but may have been missed due to e.g. the difference between
<a class="reference internal" href="../cell/word_binary.html#binary.$add" title="binary::$add"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$add</span></code></a> and <a class="reference internal" href="../cell/word_binary.html#binary.$sub" title="binary::$sub"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$sub</span></code></a>.</p>
<p>The other new command in this part is <a class="reference internal" href="../cmd/memory.html"><span class="doc">memory - translate memories to basic cells</span></a>.  <a class="reference internal" href="../cmd/memory.html#cmd-memory" title="translate memories to basic cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory</span></code></a> is another
macro command which we examine in more detail in
<a class="reference internal" href="../using_yosys/synthesis/memory.html"><span class="doc">Memory handling</span></a>.  For this document, let us focus just on
the step most relevant to our example: <a class="reference internal" href="../cmd/memory_collect.html#cmd-memory_collect" title="creating multi-port memory cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_collect</span></code></a>. Up until this point,
our memory reads and our memory writes have been totally disjoint cells;
operating on the same memory only in the abstract. <a class="reference internal" href="../cmd/memory_collect.html#cmd-memory_collect" title="creating multi-port memory cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_collect</span></code></a> combines all
of the reads and writes for a memory block into a single cell.</p>
<figure class="align-default" id="rdata-coarse">
<img alt="../_images/rdata_coarse.svg" class="width-helper invert-helper" src="../_images/rdata_coarse.svg" />
<figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="../cmd/memory_collect.html#cmd-memory_collect" title="creating multi-port memory cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_collect</span></code></a></span><a class="headerlink" href="#rdata-coarse" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Looking at the schematic after running <a class="reference internal" href="../cmd/memory_collect.html#cmd-memory_collect" title="creating multi-port memory cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_collect</span></code></a> we see that our
<a class="reference internal" href="../cell/word_mem.html#mem.$memrd_v2" title="mem::$memrd_v2"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$memrd_v2</span></code></a> cell has been replaced with a <a class="reference internal" href="../cell/word_mem.html#mem.$mem_v2" title="mem::$mem_v2"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mem_v2</span></code></a> cell named <code class="docutils literal notranslate"><span class="pre">data</span></code>, the
same name that we used in <a class="reference internal" href="#fifo-v"><span class="std std-ref">fifo.v</span></a>. Where before we had a single set of
signals for address and enable, we now have one set for reading (<code class="docutils literal notranslate"><span class="pre">RD_*</span></code>) and
one for writing (<code class="docutils literal notranslate"><span class="pre">WR_*</span></code>), as well as both <code class="docutils literal notranslate"><span class="pre">WR_DATA</span></code> input and <code class="docutils literal notranslate"><span class="pre">RD_DATA</span></code>
output.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for</p>
<ul class="simple">
<li><p><a class="reference internal" href="../using_yosys/synthesis/opt.html"><span class="doc">Optimization passes</span></a></p></li>
<li><p><a class="reference internal" href="../using_yosys/synthesis/memory.html"><span class="doc">Memory handling</span></a></p></li>
</ul>
</div>
</section>
<section id="final-note">
<h3>Final note<a class="headerlink" href="#final-note" title="Link to this heading">¶</a></h3>
<p>Having now reached the end of the the coarse-grain representation, we could also
have gotten here by running <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">synth_ice40</span><span class="w"> </span><span class="na">-top</span><span class="w"> </span><span class="n">fifo</span><span class="w"> </span><span class="na">-run</span><span class="w"> </span><span class="c">:</span><span class="n">map_ram</span></code>
after loading the design.  The <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="na">-run</span><span class="w"> </span><span class="n">&lt;from_label&gt;</span><span class="c">:</span><span class="n">&lt;to_label&gt;</span></code> option
with an empty <code class="docutils literal notranslate"><span class="pre">&lt;from_label&gt;</span></code> starts from the <a class="reference internal" href="#synth-begin"><span class="std std-ref">begin section</span></a>, while the
<code class="docutils literal notranslate"><span class="pre">&lt;to_label&gt;</span></code> runs up to but including the <a class="reference internal" href="#map-ram"><span class="std std-ref">map_ram section</span></a>.</p>
</section>
</section>
<section id="hardware-mapping">
<h2>Hardware mapping<a class="headerlink" href="#hardware-mapping" title="Link to this heading">¶</a></h2>
<p>The remaining sections each map a different type of hardware and are much more
architecture dependent than the previous sections.  As such we will only be
looking at each section very briefly.</p>
<p>If you skipped calling <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">read_verilog</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">ICE40_HX</span><span class="w"> </span><span class="na">-lib</span><span class="w"> </span><span class="na">-specify</span>
<span class="c">+/</span><span class="k">ice40</span><span class="o">/</span><span class="n">cells_sim.v</span></code> earlier, do it now.</p>
<section id="memory-blocks">
<h3>Memory blocks<a class="headerlink" href="#memory-blocks" title="Link to this heading">¶</a></h3>
<p>Mapping to hard memory blocks uses a combination of <a class="reference internal" href="../cmd/memory_libmap.html#cmd-memory_libmap" title="map memories to cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_libmap</span></code></a> and
<a class="reference internal" href="../cmd/techmap.html#cmd-techmap" title="generic technology mapper"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">techmap</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="map-ram">
<div class="code-block-caption"><span class="caption-number">Listing 16 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">map_ram</span></code> section</span><a class="headerlink" href="#map-ram" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">memory_libmap</span><span class="w"> </span><span class="na">-lib</span><span class="w"> </span><span class="nc">+/ice40/brams.txt</span><span class="w"> </span><span class="na">-lib</span><span class="w"> </span><span class="nc">+/ice40/spram.txt</span><span class="w"> </span><span class="o">[</span><span class="na">-no-auto-huge</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="na">-no-auto-block</span><span class="o">]</span><span class="w">    </span><span class="c1">(-no-auto-huge unless -spram, -no-auto-block if -nobram)</span>
<span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/ice40/brams_map.v</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/ice40/spram_map.v</span>
<span class="k">ice40_braminit</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-map-ram">
<img alt="../_images/rdata_map_ram.svg" class="width-helper invert-helper" src="../_images/rdata_map_ram.svg" />
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="#map-ram"><span class="std std-ref">map_ram section</span></a></span><a class="headerlink" href="#rdata-map-ram" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The <a class="reference internal" href="#map-ram"><span class="std std-ref">map_ram section</span></a> converts the generic <a class="reference internal" href="../cell/word_mem.html#mem.$mem_v2" title="mem::$mem_v2"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mem_v2</span></code></a> into the iCE40 <code class="docutils literal notranslate"><span class="pre">SB_RAM40_4K</span></code>
(highlighted). We can also see the memory address has been remapped, and the
data bits have been reordered (or swizzled).  There is also now a <a class="reference internal" href="../cell/word_mux.html#mux.$mux" title="mux::$mux"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mux</span></code></a> cell
controlling the value of <code class="docutils literal notranslate"><span class="pre">rdata</span></code>.  In <a class="reference internal" href="#fifo-v"><span class="std std-ref">fifo.v</span></a> we wrote our memory as
read-before-write, however the <code class="docutils literal notranslate"><span class="pre">SB_RAM40_4K</span></code> has undefined behaviour when
reading from and writing to the same address in the same cycle. As a result,
extra logic is added so that the generated circuit matches the behaviour of the
verilog.  <a class="reference internal" href="../using_yosys/synthesis/memory.html#no-rw-check"><span class="std std-ref">Synchronous SDP with undefined collision behavior</span></a> describes how we could change our verilog to match
our hardware instead.</p>
<p>If we run <a class="reference internal" href="../cmd/memory_libmap.html#cmd-memory_libmap" title="map memories to cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_libmap</span></code></a> under the <a class="reference internal" href="../cmd/debug.html#cmd-debug" title="run command with debug log messages enabled"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">debug</span></code></a> command we can see candidates which
were identified for mapping, along with the costs of each and what logic
requires emulation.</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> debug memory_libmap -lib +/ice40/brams.txt -lib +/ice40/spram.txt -no-auto-huge
<span class="go">4. Executing MEMORY_LIBMAP pass (mapping memories to cells).</span>
<span class="go">Memory fifo.data mapping candidates (post-geometry):</span>
<span class="go">- logic fallback</span>
<span class="go">  - cost: 2048.000000</span>
<span class="go">- $__ICE40_RAM4K_:</span>
<span class="go">  - option HAS_BE 0</span>
<span class="go">  - emulation score: 7</span>
<span class="go">  - replicates (for ports): 1</span>
<span class="go">  - replicates (for data): 1</span>
<span class="go">  - mux score: 0</span>
<span class="go">  - demux score: 0</span>
<span class="go">  - cost: 78.000000</span>
<span class="go">  - abits 11 dbits 2 4 8 16</span>
<span class="go">  - chosen base width 8</span>
<span class="go">  - swizzle 0 1 2 3 4 5 6 7</span>
<span class="go">  - emulate read-first behavior</span>
<span class="go">  - write port 0: port group W</span>
<span class="go">    - widths 2 4 8</span>
<span class="go">  - read port 0: port group R</span>
<span class="go">    - widths 2 4 8 16</span>
<span class="go">    - emulate transparency with write port 0</span>
<span class="go">- $__ICE40_RAM4K_:</span>
<span class="go">  - option HAS_BE 1</span>
<span class="go">  - emulation score: 7</span>
<span class="go">  - replicates (for ports): 1</span>
<span class="go">  - replicates (for data): 1</span>
<span class="go">  - mux score: 0</span>
<span class="go">  - demux score: 0</span>
<span class="go">  - cost: 78.000000</span>
<span class="go">  - abits 11 dbits 2 4 8 16</span>
<span class="go">  - byte width 1</span>
<span class="go">  - chosen base width 8</span>
<span class="go">  - swizzle 0 1 2 3 4 5 6 7</span>
<span class="go">  - emulate read-first behavior</span>
<span class="go">  - write port 0: port group W</span>
<span class="go">    - widths 16</span>
<span class="go">  - read port 0: port group R</span>
<span class="go">    - widths 2 4 8 16</span>
<span class="go">    - emulate transparency with write port 0</span>
<span class="go">Memory fifo.data mapping candidates (after post-geometry prune):</span>
<span class="go">- logic fallback</span>
<span class="go">  - cost: 2048.000000</span>
<span class="go">- $__ICE40_RAM4K_:</span>
<span class="go">  - option HAS_BE 0</span>
<span class="go">  - emulation score: 7</span>
<span class="go">  - replicates (for ports): 1</span>
<span class="go">  - replicates (for data): 1</span>
<span class="go">  - mux score: 0</span>
<span class="go">  - demux score: 0</span>
<span class="go">  - cost: 78.000000</span>
<span class="go">  - abits 11 dbits 2 4 8 16</span>
<span class="go">  - chosen base width 8</span>
<span class="go">  - swizzle 0 1 2 3 4 5 6 7</span>
<span class="go">  - emulate read-first behavior</span>
<span class="go">  - write port 0: port group W</span>
<span class="go">    - widths 2 4 8</span>
<span class="go">  - read port 0: port group R</span>
<span class="go">    - widths 2 4 8 16</span>
<span class="go">    - emulate transparency with write port 0</span>
<span class="go">mapping memory fifo.data via $__ICE40_RAM4K_</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">$__ICE40_RAM4K_</span></code> cell is defined in the file <a class="reference external" href="https://github.com/YosysHQ/yosys/tree/main/techlibs/ice40/brams.txt"><code class="file docutils literal notranslate"><span class="pre">techlibs/ice40/brams.txt</span></code></a>,
with the mapping to <code class="docutils literal notranslate"><span class="pre">SB_RAM40_4K</span></code> done by <a class="reference internal" href="../cmd/techmap.html#cmd-techmap" title="generic technology mapper"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">techmap</span></code></a> using
<a class="reference external" href="https://github.com/YosysHQ/yosys/tree/main/techlibs/ice40/brams_map.v"><code class="file docutils literal notranslate"><span class="pre">techlibs/ice40/brams_map.v</span></code></a>.  Any leftover memory cells are then converted
into flip flops (the <code class="docutils literal notranslate"><span class="pre">logic</span> <span class="pre">fallback</span></code>) with <a class="reference internal" href="../cmd/memory_map.html#cmd-memory_map" title="translate multiport memories to basic cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">memory_map</span></code></a>.</p>
<div class="literal-block-wrapper docutils container" id="map-ffram">
<div class="code-block-caption"><span class="caption-number">Listing 17 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">map_ffram</span></code> section</span><a class="headerlink" href="#map-ffram" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">opt</span><span class="w"> </span><span class="na">-fast</span><span class="w"> </span><span class="na">-mux_undef</span><span class="w"> </span><span class="na">-undriven</span><span class="w"> </span><span class="na">-fine</span>
<span class="k">memory_map</span>
<span class="k">opt</span><span class="w"> </span><span class="na">-undriven</span><span class="w"> </span><span class="na">-fine</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-map-ffram">
<img alt="../_images/rdata_map_ffram.svg" class="width-helper invert-helper" src="../_images/rdata_map_ffram.svg" />
<figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="#map-ffram"><span class="std std-ref">map_ffram section</span></a></span><a class="headerlink" href="#rdata-map-ffram" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The visual clutter on the <code class="docutils literal notranslate"><span class="pre">RDATA</span></code> output port (highlighted) is an
unfortunate side effect of <a class="reference internal" href="../cmd/opt_clean.html#cmd-opt_clean" title="remove unused cells and wires"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">opt_clean</span></code></a> on the swizzled data bits. In
connecting the <a class="reference internal" href="../cell/word_mux.html#mux.$mux" title="mux::$mux"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mux</span></code></a> input port directly to <code class="docutils literal notranslate"><span class="pre">RDATA</span></code> to reduce the number
of wires, the <code class="docutils literal notranslate"><span class="pre">$techmap579\data.0.0.RDATA</span></code> wire becomes more visually
complex.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for</p>
<ul class="simple">
<li><p><a class="reference internal" href="../using_yosys/synthesis/techmap_synth.html"><span class="doc">Technology mapping</span></a></p></li>
<li><p><a class="reference internal" href="../using_yosys/synthesis/memory.html"><span class="doc">Memory handling</span></a></p></li>
</ul>
</div>
</section>
<section id="arithmetic">
<h3>Arithmetic<a class="headerlink" href="#arithmetic" title="Link to this heading">¶</a></h3>
<p>Uses <a class="reference internal" href="../cmd/techmap.html#cmd-techmap" title="generic technology mapper"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">techmap</span></code></a> to map basic arithmetic logic to hardware.  This sees somewhat of
an explosion in cells as multi-bit <a class="reference internal" href="../cell/word_mux.html#mux.$mux" title="mux::$mux"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$mux</span></code></a> and <a class="reference internal" href="../cell/word_reg.html#reg.$adffe" title="reg::$adffe"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$adffe</span></code></a> are replaced with
single-bit <a class="reference internal" href="../cell/gate_comb_simple.html#comb_simple.$_MUX_" title="comb_simple::$_MUX_"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$_MUX_</span></code></a> and <a class="reference internal" href="../cell/gate_reg_ff.html#reg_ff.$_DFFE_PP0P_" title="reg_ff::$_DFFE_PP0P_"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$_DFFE_PP0P_</span></code></a> cells, while the <a class="reference internal" href="../cell/word_arith.html#arith.$alu" title="Arithmetic logic unit"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$alu</span></code></a> is replaced with
primitive <a class="reference internal" href="../cell/gate_comb_simple.html#comb_simple.$_OR_" title="comb_simple::$_OR_"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$_OR_</span></code></a> and <a class="reference internal" href="../cell/gate_comb_simple.html#comb_simple.$_NOT_" title="comb_simple::$_NOT_"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$_NOT_</span></code></a> gates and a <a class="reference internal" href="../cell/word_logic.html#logic.$lut" title="logic::$lut"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$lut</span></code></a> cell.</p>
<div class="literal-block-wrapper docutils container" id="map-gates">
<div class="code-block-caption"><span class="caption-number">Listing 18 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">map_gates</span></code> section</span><a class="headerlink" href="#map-gates" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">ice40_wrapcarry</span>
<span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/techmap.v</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/ice40/arith_map.v</span>
<span class="k">opt</span><span class="w"> </span><span class="na">-fast</span>
<span class="k">abc</span><span class="w"> </span><span class="na">-dff</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="m">1</span><span class="w">    </span><span class="c1">(only if -retime)</span>
<span class="k">ice40_opt</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-map-gates">
<img alt="../_images/rdata_map_gates.svg" class="width-helper invert-helper" src="../_images/rdata_map_gates.svg" />
<figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="#map-gates"><span class="std std-ref">map_gates section</span></a></span><a class="headerlink" href="#rdata-map-gates" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for
<a class="reference internal" href="../using_yosys/synthesis/techmap_synth.html"><span class="doc">Technology mapping</span></a></p>
</div>
</section>
<section id="flip-flops">
<h3>Flip-flops<a class="headerlink" href="#flip-flops" title="Link to this heading">¶</a></h3>
<p>Convert FFs to the types supported in hardware with <a class="reference internal" href="../cmd/dfflegalize.html#cmd-dfflegalize" title="convert FFs to types supported by the target"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">dfflegalize</span></code></a>, and then use
<a class="reference internal" href="../cmd/techmap.html#cmd-techmap" title="generic technology mapper"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">techmap</span></code></a> to map them.  In our example, this converts the <a class="reference internal" href="../cell/gate_reg_ff.html#reg_ff.$_DFFE_PP0P_" title="reg_ff::$_DFFE_PP0P_"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$_DFFE_PP0P_</span></code></a> cells
to <code class="docutils literal notranslate"><span class="pre">SB_DFFER</span></code>.</p>
<p>We also run <a class="reference internal" href="../cmd/simplemap.html#cmd-simplemap" title="mapping simple coarse-grain cells"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">simplemap</span></code></a> here to convert any remaining cells which could not be
mapped to hardware into gate-level primitives.  This includes optimizing
<a class="reference internal" href="../cell/gate_comb_simple.html#comb_simple.$_MUX_" title="comb_simple::$_MUX_"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$_MUX_</span></code></a> cells where one of the inputs is a constant <code class="docutils literal notranslate"><span class="pre">1'0</span></code>, replacing it
instead with an <a class="reference internal" href="../cell/gate_comb_simple.html#comb_simple.$_AND_" title="comb_simple::$_AND_"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$_AND_</span></code></a> cell.</p>
<div class="literal-block-wrapper docutils container" id="map-ffs">
<div class="code-block-caption"><span class="caption-number">Listing 19 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">map_ffs</span></code> section</span><a class="headerlink" href="#map-ffs" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">dfflegalize</span><span class="w"> </span><span class="na">-cell</span><span class="w"> </span><span class="nb">$_DFF_</span><span class="c">?</span><span class="n">_</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="na">-cell</span><span class="w"> </span><span class="nb">$_DFFE_</span><span class="c">?</span><span class="n">P_</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="na">-cell</span><span class="w"> </span><span class="nb">$_DFF_</span><span class="c">?</span><span class="n">P</span><span class="c">?</span><span class="n">_</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="na">-cell</span><span class="w"> </span><span class="nb">$_DFFE_</span><span class="c">?</span><span class="n">P</span><span class="c">?</span><span class="n">P_</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="na">-cell</span><span class="w"> </span><span class="nb">$_SDFF_</span><span class="c">?</span><span class="n">P</span><span class="c">?</span><span class="n">_</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="na">-cell</span><span class="w"> </span><span class="nb">$_SDFFCE_</span><span class="c">?</span><span class="n">P</span><span class="c">?</span><span class="n">P_</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="na">-cell</span><span class="w"> </span><span class="nb">$_DLATCH_</span><span class="c">?</span><span class="n">_</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="na">-mince</span><span class="w"> </span><span class="c">-</span><span class="m">1</span>
<span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/ice40/ff_map.v</span>
<span class="k">opt_expr</span><span class="w"> </span><span class="na">-mux_undef</span>
<span class="k">simplemap</span>
<span class="k">ice40_opt</span><span class="w"> </span><span class="na">-full</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-map-ffs">
<img alt="../_images/rdata_map_ffs.svg" class="width-helper invert-helper" src="../_images/rdata_map_ffs.svg" />
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="#map-ffs"><span class="std std-ref">map_ffs section</span></a></span><a class="headerlink" href="#rdata-map-ffs" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for
<a class="reference internal" href="../using_yosys/synthesis/techmap_synth.html"><span class="doc">Technology mapping</span></a></p>
</div>
</section>
<section id="luts">
<h3>LUTs<a class="headerlink" href="#luts" title="Link to this heading">¶</a></h3>
<p><a class="reference internal" href="../cmd/abc.html#cmd-abc" title="use ABC for technology mapping"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">abc</span></code></a> and <a class="reference internal" href="../cmd/techmap.html#cmd-techmap" title="generic technology mapper"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">techmap</span></code></a> are used to map LUTs; converting primitive cell types to use
<a class="reference internal" href="../cell/word_logic.html#logic.$lut" title="logic::$lut"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$lut</span></code></a> and <code class="docutils literal notranslate"><span class="pre">SB_CARRY</span></code> cells.  Note that the iCE40 flow uses <a class="reference internal" href="../cmd/abc9.html#cmd-abc9" title="use ABC9 for technology mapping"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">abc9</span></code></a> rather than
<a class="reference internal" href="../cmd/abc.html#cmd-abc" title="use ABC for technology mapping"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">abc</span></code></a>. For more on what these do, and what the difference between these two
commands are, refer to <a class="reference internal" href="../using_yosys/synthesis/abc.html"><span class="doc">The ABC toolbox</span></a>.</p>
<div class="literal-block-wrapper docutils container" id="map-luts">
<div class="code-block-caption"><span class="caption-number">Listing 20 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">map_luts</span></code> section</span><a class="headerlink" href="#map-luts" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">abc</span><span class="w">          </span><span class="c1">(only if -abc2)</span>
<span class="k">ice40_opt</span><span class="w">    </span><span class="c1">(only if -abc2)</span>
<span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/ice40/latches_map.v</span>
<span class="k">simplemap</span><span class="w">                                   </span><span class="c1">(if -noabc or -flowmap)</span>
<span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/gate2lut.v</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">LUT_WIDTH</span><span class="o">=</span><span class="m">4</span><span class="w">    </span><span class="c1">(only if -noabc)</span>
<span class="k">flowmap</span><span class="w"> </span><span class="na">-maxlut</span><span class="w"> </span><span class="m">4</span><span class="w">    </span><span class="c1">(only if -flowmap)</span>
<span class="k">read_verilog</span><span class="w"> </span><span class="na">-D</span><span class="w"> </span><span class="n">ICE40_HX</span><span class="w"> </span><span class="na">-icells</span><span class="w"> </span><span class="na">-lib</span><span class="w"> </span><span class="na">-specify</span><span class="w"> </span><span class="nc">+/ice40/abc9_model.v</span>
<span class="k">abc9</span><span class="w">  </span><span class="na">-W</span><span class="w"> </span><span class="m">250</span>
<span class="k">ice40_wrapcarry</span><span class="w"> </span><span class="na">-unwrap</span>
<span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/ice40/ff_map.v</span>
<span class="k">clean</span>
<span class="k">opt_lut</span><span class="w"> </span><span class="na">-tech</span><span class="w"> </span><span class="n">ice40</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-map-luts">
<img alt="../_images/rdata_map_luts.svg" class="width-helper invert-helper" src="../_images/rdata_map_luts.svg" />
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="#map-luts"><span class="std std-ref">map_luts section</span></a></span><a class="headerlink" href="#rdata-map-luts" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>Finally we use <a class="reference internal" href="../cmd/techmap.html#cmd-techmap" title="generic technology mapper"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">techmap</span></code></a> to map the generic <a class="reference internal" href="../cell/word_logic.html#logic.$lut" title="logic::$lut"><code class="xref cell cell-ref docutils literal notranslate"><span class="pre">$lut</span></code></a> cells to iCE40 <code class="docutils literal notranslate"><span class="pre">SB_LUT4</span></code>
cells.</p>
<div class="literal-block-wrapper docutils container" id="map-cells">
<div class="code-block-caption"><span class="caption-number">Listing 21 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">map_cells</span></code> section</span><a class="headerlink" href="#map-cells" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">techmap</span><span class="w"> </span><span class="na">-map</span><span class="w"> </span><span class="nc">+/ice40/cells_map.v</span><span class="w">    </span><span class="c1">(skip if -vpr)</span>
<span class="k">clean</span>
</pre></div>
</div>
</div>
<figure class="align-default" id="rdata-map-cells">
<img alt="../_images/rdata_map_cells.svg" class="width-helper invert-helper" src="../_images/rdata_map_cells.svg" />
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">rdata</span></code> output after <a class="reference internal" href="#map-cells"><span class="std std-ref">map_cells section</span></a></span><a class="headerlink" href="#rdata-map-cells" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Advanced usage docs for</p>
<ul class="simple">
<li><p><a class="reference internal" href="../using_yosys/synthesis/techmap_synth.html"><span class="doc">Technology mapping</span></a></p></li>
<li><p><a class="reference internal" href="../using_yosys/synthesis/abc.html"><span class="doc">The ABC toolbox</span></a></p></li>
</ul>
</div>
</section>
<section id="other-cells">
<h3>Other cells<a class="headerlink" href="#other-cells" title="Link to this heading">¶</a></h3>
<p>The following commands may also be used for mapping other cells:</p>
<dl class="simple">
<dt><a class="reference internal" href="../cmd/hilomap.html#cmd-hilomap" title="technology mapping of constant hi- and/or lo-drivers"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">hilomap</span></code></a></dt><dd><p>Some architectures require special driver cells for driving a constant hi or
lo value. This command replaces simple constants with instances of such
driver cells.</p>
</dd>
<dt><a class="reference internal" href="../cmd/iopadmap.html#cmd-iopadmap" title="technology mapping of i/o pads (or buffers)"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">iopadmap</span></code></a></dt><dd><p>Top-level input/outputs must usually be implemented using special I/O-pad
cells. This command inserts such cells to the design.</p>
</dd>
</dl>
<p>These commands tend to either be in the <a class="reference internal" href="#map-cells"><span class="std std-ref">map_cells section</span></a> or after the
<a class="reference internal" href="#check"><span class="std std-ref">check section</span></a> depending on the flow.</p>
</section>
</section>
<section id="final-steps">
<h2>Final steps<a class="headerlink" href="#final-steps" title="Link to this heading">¶</a></h2>
<p>The next section of the iCE40 synth flow performs some sanity checking and final
tidy up:</p>
<div class="literal-block-wrapper docutils container" id="check">
<div class="code-block-caption"><span class="caption-number">Listing 22 </span><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">check</span></code> section</span><a class="headerlink" href="#check" title="Link to this code">¶</a></div>
<div class="highlight-yoscrypt notranslate"><div class="highlight"><pre><span></span><span class="k">autoname</span>
<span class="k">hierarchy</span><span class="w"> </span><span class="na">-check</span>
<span class="k">stat</span>
<span class="k">check</span><span class="w"> </span><span class="na">-noinit</span>
<span class="k">blackbox</span><span class="w"> </span><span class="o">=</span><span class="kt">A:</span><span class="n">whitebox</span>
</pre></div>
</div>
</div>
<p>The new commands here are:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../cmd/autoname.html"><span class="doc">autoname - automatically assign names to objects</span></a>,</p></li>
<li><p><a class="reference internal" href="../cmd/stat.html"><span class="doc">stat - print some statistics</span></a>, and</p></li>
<li><p><a class="reference internal" href="../cmd/blackbox.html"><span class="doc">blackbox - convert modules into blackbox modules</span></a>.</p></li>
</ul>
<p>The output from <a class="reference internal" href="../cmd/stat.html#cmd-stat" title="print some statistics"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">stat</span></code></a> is useful for checking resource utilization; providing a
list of cells used in the design and the number of each, as well as the number
of other resources used such as wires and processes.  For this design, the final
call to <a class="reference internal" href="../cmd/stat.html#cmd-stat" title="print some statistics"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">stat</span></code></a> should look something like the following:</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> stat -top fifo

<span class="go">17. Printing statistics.</span>

<span class="go">=== fifo ===</span>

<span class="go">   Number of wires:                 96</span>
<span class="go">   Number of wire bits:            264</span>
<span class="go">   Number of public wires:          96</span>
<span class="go">   Number of public wire bits:     264</span>
<span class="go">   Number of ports:                  7</span>
<span class="go">   Number of port bits:             29</span>
<span class="go">   Number of memories:               0</span>
<span class="go">   Number of memory bits:            0</span>
<span class="go">   Number of processes:              0</span>
<span class="go">   Number of cells:                140</span>
<span class="go">     $scopeinfo                      2</span>
<span class="go">     SB_CARRY                       26</span>
<span class="go">     SB_DFF                         26</span>
<span class="go">     SB_DFFER                       25</span>
<span class="go">     SB_LUT4                        60</span>
<span class="go">     SB_RAM40_4K                     1</span>
</pre></div>
</div>
<p>Note that the <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="na">-top</span><span class="w"> </span><span class="n">fifo</span></code> here is optional.  <a class="reference internal" href="../cmd/stat.html#cmd-stat" title="print some statistics"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">stat</span></code></a> will automatically
use the module with the <code class="docutils literal notranslate"><span class="pre">top</span></code> attribute set, which <code class="docutils literal notranslate"><span class="pre">fifo</span></code> was when we called
<a class="reference internal" href="../cmd/hierarchy.html#cmd-hierarchy" title="check, expand and clean up design hierarchy"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">hierarchy</span></code></a>.  If no module is marked <code class="docutils literal notranslate"><span class="pre">top</span></code>, then stats will be shown for each
module selected.</p>
<p>The <a class="reference internal" href="../cmd/stat.html#cmd-stat" title="print some statistics"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">stat</span></code></a> output is also useful as a kind of sanity-check: Since we have
already run <a class="reference internal" href="../cmd/proc.html#cmd-proc" title="translate processes to netlists"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">proc</span></code></a>, we wouldn’t expect there to be any processes. We also expect
<code class="docutils literal notranslate"><span class="pre">data</span></code> to use hard memory; if instead of an <code class="docutils literal notranslate"><span class="pre">SB_RAM40_4K</span></code> saw a high number
of flip-flops being used we might suspect something was wrong.</p>
<p>If we instead called <a class="reference internal" href="../cmd/stat.html#cmd-stat" title="print some statistics"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">stat</span></code></a> immediately after <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">read_verilog</span><span class="w"> </span><span class="n">fifo.v</span></code> we
would see something very different:</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">yosys&gt;</span> stat

<span class="go">2. Printing statistics.</span>

<span class="go">=== fifo ===</span>

<span class="go">   Number of wires:                 28</span>
<span class="go">   Number of wire bits:            219</span>
<span class="go">   Number of public wires:           9</span>
<span class="go">   Number of public wire bits:      45</span>
<span class="go">   Number of ports:                  7</span>
<span class="go">   Number of port bits:             29</span>
<span class="go">   Number of memories:               1</span>
<span class="go">   Number of memory bits:         2048</span>
<span class="go">   Number of processes:              3</span>
<span class="go">   Number of cells:                  9</span>
<span class="go">     $add                            1</span>
<span class="go">     $logic_and                      2</span>
<span class="go">     $logic_not                      2</span>
<span class="go">     $memrd                          1</span>
<span class="go">     $sub                            1</span>
<span class="go">     addr_gen                        2</span>

<span class="go">=== addr_gen ===</span>

<span class="go">   Number of wires:                  8</span>
<span class="go">   Number of wire bits:             60</span>
<span class="go">   Number of public wires:           4</span>
<span class="go">   Number of public wire bits:      11</span>
<span class="go">   Number of ports:                  4</span>
<span class="go">   Number of port bits:             11</span>
<span class="go">   Number of memories:               0</span>
<span class="go">   Number of memory bits:            0</span>
<span class="go">   Number of processes:              2</span>
<span class="go">   Number of cells:                  2</span>
<span class="go">     $add                            1</span>
<span class="go">     $eq                             1</span>
</pre></div>
</div>
<p>Notice how <code class="docutils literal notranslate"><span class="pre">fifo</span></code> and <code class="docutils literal notranslate"><span class="pre">addr_gen</span></code> are listed separately, and the statistics
for <code class="docutils literal notranslate"><span class="pre">fifo</span></code> show 2 <code class="docutils literal notranslate"><span class="pre">addr_gen</span></code> modules.  Because this is before the memory has
been mapped, we also see that there is 1 memory with 2048 memory bits; matching
our 8-bit wide <code class="docutils literal notranslate"><span class="pre">data</span></code> memory with 256 values (<span class="math notranslate nohighlight">\(8*256=2048\)</span>).</p>
<section id="synthesis-output">
<h3>Synthesis output<a class="headerlink" href="#synthesis-output" title="Link to this heading">¶</a></h3>
<p>The iCE40 synthesis flow has the following output modes available:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../cmd/write_blif.html"><span class="doc">write_blif - write design to BLIF file</span></a>,</p></li>
<li><p><a class="reference internal" href="../cmd/write_edif.html"><span class="doc">write_edif - write design to EDIF netlist file</span></a>, and</p></li>
<li><p><a class="reference internal" href="../cmd/write_json.html"><span class="doc">write_json - write design to a JSON file</span></a>.</p></li>
</ul>
<p>As an example, if we called <code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">synth_ice40</span><span class="w"> </span><span class="na">-top</span><span class="w"> </span><span class="n">fifo</span><span class="w"> </span><span class="na">-json</span><span class="w"> </span><span class="n">fifo.json</span></code>,
our synthesized <code class="docutils literal notranslate"><span class="pre">fifo</span></code> design will be output as <code class="file docutils literal notranslate"><span class="pre">fifo.json</span></code>.  We can
then read the design back into Yosys with <a class="reference internal" href="../cmd/read_json.html#cmd-read_json" title="read JSON file"><code class="xref cmd cmd-ref docutils literal notranslate"><span class="pre">read_json</span></code></a>, but make sure you use
<code class="code highlight yoscrypt docutils literal highlight-yoscrypt"><span class="k">design</span><span class="w"> </span><span class="na">-reset</span></code> or open a new interactive terminal first.  The JSON
output we get can also be loaded into <a class="reference external" href="https://github.com/YosysHQ/nextpnr">nextpnr</a> to do place and route; but that
is beyond the scope of this documentation.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../cmd/synth_ice40.html"><span class="doc">synth_ice40 - synthesis for iCE40 FPGAs</span></a></p>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="scripting_intro.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Scripting in Yosys</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="installation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Installation</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025 YosysHQ GmbH
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link" href="https://readthedocs.org/projects/yosys" aria-label="On Read the Docs">
                <svg x="0px" y="0px" viewBox="-125 217 360 360" xml:space="preserve">
                  <path fill="currentColor" d="M39.2,391.3c-4.2,0.6-7.1,4.4-6.5,8.5c0.4,3,2.6,5.5,5.5,6.3 c0,0,18.5,6.1,50,8.7c25.3,2.1,54-1.8,54-1.8c4.2-0.1,7.5-3.6,7.4-7.8c-0.1-4.2-3.6-7.5-7.8-7.4c-0.5,0-1,0.1-1.5,0.2 c0,0-28.1,3.5-50.9,1.6c-30.1-2.4-46.5-7.9-46.5-7.9C41.7,391.3,40.4,391.1,39.2,391.3z M39.2,353.6c-4.2,0.6-7.1,4.4-6.5,8.5 c0.4,3,2.6,5.5,5.5,6.3c0,0,18.5,6.1,50,8.7c25.3,2.1,54-1.8,54-1.8c4.2-0.1,7.5-3.6,7.4-7.8c-0.1-4.2-3.6-7.5-7.8-7.4 c-0.5,0-1,0.1-1.5,0.2c0,0-28.1,3.5-50.9,1.6c-30.1-2.4-46.5-7.9-46.5-7.9C41.7,353.6,40.4,353.4,39.2,353.6z M39.2,315.9 c-4.2,0.6-7.1,4.4-6.5,8.5c0.4,3,2.6,5.5,5.5,6.3c0,0,18.5,6.1,50,8.7c25.3,2.1,54-1.8,54-1.8c4.2-0.1,7.5-3.6,7.4-7.8 c-0.1-4.2-3.6-7.5-7.8-7.4c-0.5,0-1,0.1-1.5,0.2c0,0-28.1,3.5-50.9,1.6c-30.1-2.4-46.5-7.9-46.5-7.9 C41.7,315.9,40.4,315.8,39.2,315.9z M39.2,278.3c-4.2,0.6-7.1,4.4-6.5,8.5c0.4,3,2.6,5.5,5.5,6.3c0,0,18.5,6.1,50,8.7 c25.3,2.1,54-1.8,54-1.8c4.2-0.1,7.5-3.6,7.4-7.8c-0.1-4.2-3.6-7.5-7.8-7.4c-0.5,0-1,0.1-1.5,0.2c0,0-28.1,3.5-50.9,1.6 c-30.1-2.4-46.5-7.9-46.5-7.9C41.7,278.2,40.4,278.1,39.2,278.3z M-13.6,238.5c-39.6,0.3-54.3,12.5-54.3,12.5v295.7 c0,0,14.4-12.4,60.8-10.5s55.9,18.2,112.9,19.3s71.3-8.8,71.3-8.8l0.8-301.4c0,0-25.6,7.3-75.6,7.7c-49.9,0.4-61.9-12.7-107.7-14.2 C-8.2,238.6-10.9,238.5-13.6,238.5z M19.5,257.8c0,0,24,7.9,68.3,10.1c37.5,1.9,75-3.7,75-3.7v267.9c0,0-19,10-66.5,6.6 C59.5,536.1,19,522.1,19,522.1L19.5,257.8z M-3.6,264.8c4.2,0,7.7,3.4,7.7,7.7c0,4.2-3.4,7.7-7.7,7.7c0,0-12.4,0.1-20,0.8 c-12.7,1.3-21.4,5.9-21.4,5.9c-3.7,2-8.4,0.5-10.3-3.2c-2-3.7-0.5-8.4,3.2-10.3c0,0,0,0,0,0c0,0,11.3-6,27-7.5 C-16,264.9-3.6,264.8-3.6,264.8z M-11,302.6c4.2-0.1,7.4,0,7.4,0c4.2,0.5,7.2,4.3,6.7,8.5c-0.4,3.5-3.2,6.3-6.7,6.7 c0,0-12.4,0.1-20,0.8c-12.7,1.3-21.4,5.9-21.4,5.9c-3.7,2-8.4,0.5-10.3-3.2c-2-3.7-0.5-8.4,3.2-10.3c0,0,11.3-6,27-7.5 C-20.5,302.9-15.2,302.7-11,302.6z M-3.6,340.2c4.2,0,7.7,3.4,7.7,7.7s-3.4,7.7-7.7,7.7c0,0-12.4-0.1-20,0.7 c-12.7,1.3-21.4,5.9-21.4,5.9c-3.7,2-8.4,0.5-10.3-3.2c-2-3.7-0.5-8.4,3.2-10.3c0,0,11.3-6,27-7.5C-16,340.1-3.6,340.2-3.6,340.2z" />
                </svg>
              </a><a class="muted-link" href="https://github.com/YosysHQ/yosys" aria-label="On GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
              </a>
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
          YosysHQ
          </span>
        </div>
        <div class="toc-tree-container yosyshq-links" style="padding-bottom: 0">
          <div class="toc-tree">
            <ul>
              <li></li>
              <li><a class="reference external" href="https://yosyshq.readthedocs.io">Docs</a></li>
              <li><a class="reference external" href="https://blog.yosyshq.com">Blog</a></li>
              <li><a class="reference external" href="https://www.yosyshq.com">Website</a></li>
            </ul>
          </div>
        </div>
        
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Synthesis starter</a><ul>
<li><a class="reference internal" href="#demo-design">Demo design</a></li>
<li><a class="reference internal" href="#loading-the-design">Loading the design</a></li>
<li><a class="reference internal" href="#elaboration">Elaboration</a><ul>
<li><a class="reference internal" href="#the-addr-gen-module">The addr_gen module</a></li>
<li><a class="reference internal" href="#the-full-example">The full example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#flattening">Flattening</a></li>
<li><a class="reference internal" href="#the-coarse-grain-representation">The coarse-grain representation</a><ul>
<li><a class="reference internal" href="#part-1">Part 1</a></li>
<li><a class="reference internal" href="#part-2">Part 2</a></li>
<li><a class="reference internal" href="#part-3">Part 3</a></li>
<li><a class="reference internal" href="#part-4">Part 4</a></li>
<li><a class="reference internal" href="#final-note">Final note</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hardware-mapping">Hardware mapping</a><ul>
<li><a class="reference internal" href="#memory-blocks">Memory blocks</a></li>
<li><a class="reference internal" href="#arithmetic">Arithmetic</a></li>
<li><a class="reference internal" href="#flip-flops">Flip-flops</a></li>
<li><a class="reference internal" href="#luts">LUTs</a></li>
<li><a class="reference internal" href="#other-cells">Other cells</a></li>
</ul>
</li>
<li><a class="reference internal" href="#final-steps">Final steps</a><ul>
<li><a class="reference internal" href="#synthesis-output">Synthesis output</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
        
      </div>
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=33dbc229"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo-ys.js?v=8d9c4053"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>